# SmartSpec Workflow: Data Model Validator

**Workflow:** `/smartspec_data_model_validator`  
**Version:** 6.1.1

## 1. Overview

The Data Model Validator is a static analysis workflow that ensures your application's data model (e.g., ORM models, schema files) is consistent with the data model defined in your `spec.md`. It acts as a crucial bridge between specification and implementation, preventing data model drift.

This is a **reports-only** workflow. It does not connect to a live database or execute migrations, making it safe to run in any environment.

## 2. Key Features

- **Drift Detection:** Identifies discrepancies between the `spec.md` and the implementation's data model.
- **Static Analysis:** Validates models without requiring a database connection.
- **ORM and Schema Support:** Works with various sources, including Prisma schemas, ORM model files, and raw SQL schema files.
- **CI/CD Integration:** Designed as a fast, reliable quality gate in CI pipelines.
- **Foundation for Automation:** The report generated by this workflow is the primary input for the `/smartspec_data_migration_generator`.

## 3. How It Works

The workflow performs a series of checks to compare the `spec.md` against the implementation files:

1.  **Parses Spec:** Extracts the data model definition from the `spec.md`.
2.  **Scans Implementation:** Analyzes the specified schema, model, or migration files.
3.  **Compares Models:** Checks for discrepancies, including:
    -   **Missing Tables/Models:** Models in the spec that are not in the code.
    -   **Missing Columns/Fields:** Fields in the spec that are missing from the code.
    -   **Type Mismatches:** Fields with different data types between the spec and code.
    -   **Undocumented Models/Fields:** Models or fields in the code that are not in the spec.
4.  **Generates Report:** Produces a detailed `report.md` and `summary.json` that lists all findings.

## 4. Usage

### Command Line

```bash
/smartspec_data_model_validator \
  specs/my-feature/spec.md \
  --schema-files "prisma/schema.prisma" \
  --strict
```

### Kilo Code

```bash
/smartspec_data_model_validator.md \
  specs/my-feature/spec.md \
  --model-files "src/models/**/*.ts" \
  --orm typeorm
```

## 5. Input and Flags

- **`spec_md` (Required):** Path to the `spec.md` file.
- **`--schema-files <glob>` (Optional):** Glob pattern for database schema files (e.g., `schema.sql`).
- **`--model-files <glob>` (Optional):** Glob pattern for ORM model files (e.g., `src/models/**/*.ts`).
- **`--migration-files <glob>` (Optional):** Glob pattern for migration files.
- **`--dialect <postgres|mysql|...>` (Optional):** Specifies the SQL dialect.
- **`--orm <prisma|typeorm|...>` (Optional):** Specifies the ORM framework used.
- **`--strict` (Optional):** Fails the workflow on any MUST-level violation.

## 6. Output: Validation Report

The workflow generates a report in `.spec/reports/data-model-validation/`.

### Example `summary.json` Snippet

```json
{
  "check_id": "DMV-002",
  "model": "User",
  "status": "fail",
  "severity": "high",
  "why": "Model 'User' is missing field 'last_login_at' defined in spec.md.",
  "details": {
    "spec_field": {
      "name": "last_login_at",
      "type": "datetime"
    }
  }
}
```

## 7. Use Cases

- **Automated Schema Review:** Automatically check that developers have correctly implemented the data model from the spec.
- **Input for Migration Generation:** Use the output report to feed the `/smartspec_data_migration_generator` and automate schema changes.
- **Prevent Data Inconsistencies:** Catch data model drift before it leads to bugs or data corruption.
