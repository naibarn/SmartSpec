# /smartspec_docs_publisher Manual (v6.0, English)

## Overview

The `/smartspec_docs_publisher` workflow (version **6.1.1**) is a **documentation/publishing** utility designed to safely publish documentation artifacts generated by workflows like `/smartspec_docs_generator`.

**Purpose:** Publish documentation to a hosting platform (GitHub Pages or Read the Docs) using a secure, preview-first, no-shell, and allowlisted approach.

**Key Features:**

*   **Security Hardened:** Bans shell execution, allowlists binaries (`git` only), enforces path safety (normalization, no symlink escape), and requires explicit network permission (`--allow-network`).
*   **Preview-First:** Without the `--apply` flag, it generates a detailed `publish_plan.md` and `change_plan.md` detailing all proposed actions without executing them.
*   **Reports-Only:** All writes are restricted to a temporary workspace under the run folder (`.spec/reports/docs-publisher/<run-id>/workspace/**`) and reports (`.spec/reports/docs-publisher/**`).

**Supported Platforms:**

1.  GitHub Pages (via `gh-pages` branch operations).
2.  Read the Docs (via webhook trigger).

## Usage

### CLI Usage

The CLI is used to invoke the workflow directly from the command line.

#### Preview Mode (Required for planning)

This command generates the publish plan without performing any network operations or publishing.

```bash
/smartspec_docs_publisher \
  --docs-dir <path/to/generated/docs> \
  --publish-platform github-pages \
  --version v1.2.3 \
  --remote origin \
  --github-branch gh-pages \
  --out .spec/reports/docs-publisher
```

#### Apply Mode (Required for execution)

To execute the publish operation, the `--apply` and `--allow-network` flags are mandatory.

**GitHub Pages Example:**
```bash
/smartspec_docs_publisher \
  --docs-dir <path/to/generated/docs> \
  --publish-platform github-pages \
  --version v1.2.3 \
  --remote origin \
  --github-branch gh-pages \
  --allow-network \
  --apply \
  --out .spec/reports/docs-publisher
```

**Read the Docs Example:**
```bash
/smartspec_docs_publisher \
  --docs-dir <path/to/generated/docs> \
  --publish-platform readthedocs \
  --version v1.2.3 \
  --rtd-project-slug my-project-slug \
  --rtd-webhook-secret-ref env:RTD_SECRET_TOKEN \
  --allow-network \
  --apply \
  --out .spec/reports/docs-publisher
```

### Kilo Code Usage

Kilo Code is the preferred method for integrating this workflow into larger SmartSpec pipelines.

**Kilo Code Example (GitHub Pages Apply):**

```bash
/smartspec_docs_publisher.md \
  --docs-dir .spec/reports/docs-generator/<run-id>/bundle.preview \
  --publish-platform github-pages \
  --version v1.2.3 \
  --remote origin \
  --github-branch gh-pages \
  --allow-network \
  --apply \
  --out .spec/reports/docs-publisher \
  --kilocode
```

## Use Cases

### Use Case 1: Publishing Documentation to GitHub Pages

**Scenario:** A CI pipeline successfully runs `/smartspec_docs_generator`, placing the built documentation in a temporary report directory. We need to publish this documentation to the `gh-pages` branch of the `origin` remote under version `v2.0.0`.

**Input Data:**
*   Docs Source: `.spec/reports/dg/12345/bundle.preview`
*   Target Platform: `github-pages`
*   Version: `v2.0.0`
*   Remote/Branch: `origin`/`gh-pages`

**Command (CLI):**
```bash
/smartspec_docs_publisher \
  --docs-dir .spec/reports/dg/12345/bundle.preview \
  --publish-platform github-pages \
  --version v2.0.0 \
  --remote origin \
  --github-branch gh-pages \
  --allow-network \
  --apply \
  --out .spec/reports/docs-publisher/run-A
```

**Expected Result:**
1.  **Exit Code:** 0 (Success).
2.  **Artifacts:** Reports generated under `.spec/reports/docs-publisher/run-A/`.
3.  **Operation:** A temporary git workspace is created, the `gh-pages` branch is updated with the content of the docs directory, committed with a message containing `v2.0.0`, and pushed to the `origin` remote.

### Use Case 2: Triggering a Read the Docs Build

**Scenario:** After generating documentation for a patch release (`v1.1.5`), we need to trigger a build on Read the Docs using a pre-configured webhook secret stored in the environment variable `RTD_PUBLISH_TOKEN`.

**Input Data:**
*   Docs Source: `.spec/reports/dg/54321/bundle.preview`
*   Target Platform: `readthedocs`
*   Version: `v1.1.5`
*   RTD Project Slug: `my-smartspec-project`
*   Secret Reference: `env:RTD_PUBLISH_TOKEN`

**Command (Kilo Code):**
```bash
/smartspec_docs_publisher.md \
  --docs-dir .spec/reports/dg/54321/bundle.preview \
  --publish-platform readthedocs \
  --version v1.1.5 \
  --rtd-project-slug my-smartspec-project \
  --rtd-webhook-secret-ref env:RTD_PUBLISH_TOKEN \
  --allow-network \
  --apply \
  --out .spec/reports/docs-publisher/run-B \
  --kilocode
```

**Expected Result:**
1.  **Exit Code:** 0 (Success).
2.  **Operation:** The workflow uses its built-in HTTP client to send a request to the Read the Docs webhook endpoint, using the referenced secret for authentication, triggering a documentation build for version `v1.1.5`. No Git operations are performed.
3.  **Artifacts:** The `publish_plan.md` confirms the successful HTTP POST operation, and the `summary.json` records the action without exposing the secret or full URL.

### Use Case 3: Generating a Preview Plan (Safety Check)

**Scenario:** Before committing to a publish operation, a developer wants to ensure the workflow correctly identifies the target platform and outlines the exact Git commands it will run for GitHub Pages.

**Input Data:**
*   Docs Source: `docs/output/latest`
*   Target Platform: `github-pages`
*   Version: `v3.0.0-beta`

**Command (CLI - Preview Mode):**
```bash
/smartspec_docs_publisher \
  --docs-dir docs/output/latest \
  --publish-platform github-pages \
  --version v3.0.0-beta \
  --remote upstream \
  --github-branch docs-staging \
  --out .spec/reports/docs-publisher/run-C
```

**Expected Result:**
1.  **Exit Code:** 0 (Success).
2.  **Operation:** No network or file modification occurs outside the report directory.
3.  **Artifacts:** The `publish_plan.md` and `change_plan.md` detail the sequence of `git` commands (e.g., `git fetch upstream`, `git checkout docs-staging`, `git add`, `git commit`, `git push upstream docs-staging`) that *would* be executed if `--apply` and `--allow-network` were present.

## Parameters

The table below lists all parameters supported by `/smartspec_docs_publisher`.

| Flag | Category | Description | Required | Constraints |
| :--- | :--- | :--- | :--- | :--- |
| `--docs-dir <path>` | Core | Directory containing built documentation artifacts to publish. | Yes | Must exist, be within project root, and pass path safety checks. |
| `--publish-platform <platform>` | Core | Target hosting platform. | Yes | `github-pages` or `readthedocs` |
| `--version <semver>` | Core | Documentation version label (e.g., `v1.2.3`). | Yes | Must match safe SemVer pattern. |
| `--allow-network` | Security | Explicitly permits network operations (e.g., git push, webhook trigger). | Required for Apply | Boolean flag. |
| `--apply` | Execution | Executes the publish plan instead of just generating a preview. | Required for Apply | Boolean