---
manual_name: /smartspec_implement_tasks Manual (EN)
manual_version: 5.6
compatible_workflow: /smartspec_implement_tasks
compatible_workflow_versions: 5.6.3 – 5.6.4
role: user/operator manual (tech lead, architect, senior engineer, platform, spec owner)
---

# /smartspec_implement_tasks Manual (v5.6, English)

## 1. Overview

This manual explains how to use the workflow:

> `/smartspec_implement_tasks v5.6.x` (e.g., v5.6.3 – v5.6.4)

The workflow **implements code based on an existing `tasks.md`** that was generated from your SmartSpec chain:

1. `/smartspec_generate_spec`
2. `/smartspec_generate_plan`
3. `/smartspec_generate_tasks`
4. `/smartspec_implement_tasks`  ← this workflow

Core goals:

- Turn `tasks.md` into **real, traceable code and config changes**, safely.
- Respect SmartSpec **centralization and ownership** rules:
  - SPEC_INDEX and registries are the source of truth.
  - Do not re-invent APIs/models/terms/components that already exist.
- Play nicely with **multi-repo / multi-registry** environments.
- Align with **UI mode** and design systems:
  - JSON-first UI (`ui.json`) vs inline UI.
- Enforce **modern guardrails**:
  - React/Next.js/RSC/Node/npm dependency/security constraints.
  - AI/LLM prompt + logging safety.
  - Data-sensitivity, secrets, and PII protection.
- Work cleanly with **KiloCode** (`--kilocode`) and Orchestrator when available.

> **Important:**
> - This workflow has `write_guard: ALLOW-WRITE`, but **only within the current repo**.
> - It must **not** write into sibling repos discovered via `--workspace-roots`/`--repos-config`.
> - It should never modify `spec.md` or `tasks.md` in ways that break the SmartSpec chain.

---

## 2. What’s New in v5.6

This v5.6 manual supersedes older `/smartspec_implement_tasks` guides while preserving all safe behaviors.

### 2.1 Alignment with v5.6 SmartSpec chain

- Assumes `tasks.md` was generated by `/smartspec_generate_tasks v5.6.x`.
- Expects:
  - clear **task IDs** and optional subtasks (`T001.1`, `T001.2`, ...);
  - **resource usage metadata** (reuse vs create, registry owners);
  - hints about UI/web/AI/data guardrails.

### 2.2 Canonical index & registries (centralization)

- Uses **canonical SPEC_INDEX** and registries under `.spec/`:
  - `.spec/SPEC_INDEX.json` (primary)
  - `.spec/registry/` (primary registry)
- Supports legacy mirrors for backward compatibility (e.g., `SPEC_INDEX.json` at repo root) but treats `.spec/` as authoritative.

### 2.3 Multi-repo / multi-registry support

- New/clarified flags:
  - `--index`, `--specindex`
  - `--registry-dir`, `--registry-roots`
  - `--workspace-roots`, `--repos-config`
- Behavior:
  - External repos (from `--workspace-roots`/`--repos-config`) are **read-only**.
  - Implementations must **reuse** external owners rather than re-create shared entities.

### 2.4 Safety modes & reports

- Introduces `--safety-mode=<strict|dev>` and alias `--strict`.
- Adds `--report-dir` and `--stdout-summary` to produce **run reports** under `.spec/reports/implement-tasks/` (or custom path).
- Encourages `safety_status` markers in summaries and CI.

### 2.5 Web/AI/data guardrails

- When tasks reference React/Next.js/RSC/Node/npm stacks, the workflow should:
  - consult `tool-version-registry.json` (if present) for baselines;
  - avoid unsafe downgrades and disallowed combinations;
  - implement dependency hygiene (lockfiles, SCA, `npm audit`, etc.).
- When tasks reference AI/LLM features, the workflow should:
  - follow prompt + logging safety rules from spec/tasks;
  - avoid inserting secrets/PII into prompts or logs.
- When tasks involve sensitive data, the workflow should:
  - respect classification/masking rules encoded in spec/tasks.

### 2.6 KiloCode & Orchestrator

- Clarifies that `--kilocode` enables Orchestrator-mode where available.
- Fallback: if Orchestrator cannot be activated, the workflow must degrade gracefully to standard mode with a clear warning.

---

## 3. Backward Compatibility Notes

- All behavior from earlier `/smartspec_implement_tasks` manuals is **preserved**, including:
  - **Task selection flags**: `--task`, `--tasks`, `--range`, `--from`, `--skip-completed`, `--resume`.
  - **Phase filtering flags**: `--phase`, `--phases`, `--phase-range`.
  - **Validate-only** mode via `--validate-only`.
  - Checkbox update rules and final summary requirements.
- New features are **additive**:
  - multi-repo/multi-registry flags;
  - safety-mode flags;
  - reporting flags;
  - web/AI/data guardrails.
- No flag or feature from v5.2 is removed.

---

## 4. Core Concepts

### 4.1 Where this workflow fits

- `spec.md` defines **requirements**.
- `plan.md` (optional) defines **phases & sequencing**.
- `tasks.md` defines **executable tasks**.
- `/smartspec_implement_tasks` uses all of the above to **change code and configuration**.

### 4.2 SPEC_INDEX & registries

- `SPEC_INDEX`:
  - maps spec IDs to locations and dependencies.
- Registries (under `.spec/registry/`):
  - API registry
  - Data model registry
  - Glossary / domain terms
  - UI component & pattern registries
  - Tool-version registry for React/Next.js/Node/npm (when used)

The workflow should consult these to ensure it does **not** invent conflicting APIs, models, or UI components.

### 4.3 Multi-repo environments

- `--workspace-roots` and `--repos-config` let the workflow locate specs and registries in sibling repos.
- Cross-repo rules:
  - Sibling repos are **read-only**.
  - If a task targets an API/model/pattern owned in another repo, implementation must be done via **integration**, not re-definition.

### 4.4 Evidence-first implementation

Before introducing new constructs, the workflow should:

1. Read referenced specs and tasks.
2. Resolve owners via SPEC_INDEX and registries.
3. Search the codebase for existing:
   - middleware/guards
   - API clients / gateways
   - domain models
   - UI components and patterns
4. Only create new entities when:
   - no owner is found, and
   - no conflicting definition exists.

### 4.5 UI JSON vs inline UI

- If the spec/tasks use **JSON-first UI**:
  - `ui.json` is treated as design source of truth.
  - Implementations should bind or extend components without embedding business logic inside UI metadata.
- If using **inline UI**:
  - Implementation is guided by `spec.md` text;
  - still must respect design tokens, App components, and patterns.

### 4.6 Safety modes

- `strict`:
  - For production-bound work.
  - Treats missing critical context (index/registries/guardrails) as **risks** that must be explicitly handled or blocked.
- `dev`:
  - For local and exploratory work.
  - Allows best-effort implementation with warnings.

### 4.7 Web/AI/data guardrails

The workflow must treat:

- React/Next.js/Node/RSC stacks as **high-risk surfaces**.
- AI/LLM features as **untrusted agents** that need prompt/logging constraints.
- Sensitive data as **classified**, with masking/redaction rules.

Tasks in `tasks.md` should already encode these; implementation must follow them.

---

## 5. When to Use `/smartspec_implement_tasks`

Use this workflow when:

- You have a `tasks.md` and want to **implement a subset of tasks** safely.
- You want an **evidence-first** implementation that respects:
  - existing code,
  - canonical APIs/models/terms,
  - UI components and patterns.
- You need **controlled scope**:
  - single task, multiple tasks, ranges, phases, or resume.
- You want an implementation run that ends with a **clear summary** for review.

Avoid using this workflow when:

- `tasks.md` is clearly out of date with `spec.md` and `plan.md` → regenerate tasks first.
- You need to **edit the spec** → use `/smartspec_generate_spec`.
- You need to **regenerate tasks** → use `/smartspec_generate_tasks`.

---

## 6. Inputs & Outputs

### 6.1 Required input

- Path to `tasks.md`, e.g.:

```bash
/smartspec_implement_tasks specs/feature/spec-005-promo-system/tasks.md
```

### 6.2 Optional inputs

- `spec.md` and `plan.md` will be inferred from the folder structure when present.
- `SPEC_INDEX` and registries will be located using canonical order unless overridden with flags.

### 6.3 Outputs

- Code and config changes in files referenced by tasks.
- Updated `tasks.md` checkboxes where work is complete.
- Optional implementation notes (if allowed by team conventions).
- Final summary:
  - tasks attempted and completed,
  - files changed,
  - risks and blockers,
  - suggested next steps.
- Optional report under `.spec/reports/implement-tasks/` (or `--report-dir`).

---

## 7. CLI & Flags

### 7.1 Basic invocation

```bash
/smartspec_implement_tasks <path/to/tasks.md>
```

### 7.2 Task selection

- `--task=<n>`
- `--tasks=<n1,n2,...>`
- `--range=<start-end>`
- `--from=<n>`
- `--skip-completed`
- `--resume`

These flags let you control **exactly which tasks** are in scope for this run.

### 7.3 Phase filtering

If tasks are grouped into phases:

- `--phase=<n>`
- `--phases=<n1,n2,...>`
- `--phase-range=<n1-n2>`

Phase filtering is often used alongside `--skip-completed`.

### 7.4 Safety & validation

- `--validate-only`
  - read-only dry run; does not change code or task checkboxes.
- `--safety-mode=<strict|dev>`
- `--strict` (alias for `--safety-mode=strict`)

In strict mode, missing governance artifacts or unresolved conflicts should be treated as **blocking or high-risk**, and clearly reported.

### 7.5 Index, registries, multi-repo

- `--index=<path>` / `--specindex=<path>`
- `--registry-dir=<path>`
- `--registry-roots=<dir1,dir2,...>`
- `--workspace-roots=<dir1,dir2,...>`
- `--repos-config=<path>`

Use these when you need to point the workflow at specific indexes or registries (e.g., in monorepos with multiple `.spec/` roots).

### 7.6 Reporting & orchestration

- `--report-dir=<path>`
  - Override default `.spec/reports/implement-tasks/`.
- `--stdout-summary`
  - Print a concise summary to stdout.
- `--kilocode`
  - Attempt Orchestrator-mode when supported.

---

## 8. Checkbox & Summary Rules

### 8.1 Checkbox update rules

The workflow may only check a task as completed when:

- All code/config changes described in the task are implemented.
- Acceptance criteria (in tasks/spec) are satisfied.
- Required tests (if any) have been added/updated.

For partial work:

- Leave the checkbox unchecked.
- Optionally add short notes (if your team permits) describing what remains.

### 8.2 Required final summary

Each run must end with a summary that includes:

- Tasks attempted.
- Tasks completed.
- Files changed/created.
- Open risks or blockers.
- Suggested next command(s) (e.g., resume, validate, or run tests).

---

## 9. Use Case Examples (English)

### 9.1 Implement Phase 1 only

```bash
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --phase=1 \
  --skip-completed
```

- Implements only Phase 1 tasks.
- Skips tasks already marked as completed.

### 9.2 Iterative implementation with Orchestrator

```bash
# First chunk
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --range=1-6 \
  --skip-completed \
  --kilocode

# Resume later
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --resume
```

### 9.3 Validate only (no code changes)

```bash
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --phase=1 \
  --validate-only
```

Use this to confirm scope and guardrails before actual implementation.

### 9.4 Multi-repo implementation respecting a platform owner

```bash
/smartspec_implement_tasks \
  specs/payments/spec-pay-010-refund-service/tasks.md \
  --index=../platform/.spec/SPEC_INDEX.json \
  --registry-dir=.spec/registry \
  --registry-roots="../platform/.spec/registry" \
  --workspace-roots="../platform;../billing" \
  --repos-config=.spec/smartspec.repos.json \
  --safety-mode=strict \
  --stdout-summary
```

- Treats platform APIs/models as external owners.
- Only implements integration/client logic in the current repo.

### 9.5 Implementing a Next.js UI feature

```bash
/smartspec_implement_tasks \
  specs/web/spec-web-020-account-settings/tasks.md \
  --index=.spec/SPEC_INDEX.json \
  --registry-dir=.spec/registry \
  --safety-mode=strict \
  --stdout-summary
```

- Implementation must:
  - consult `tool-version-registry.json` for React/Next/Node baselines;
  - maintain/extend lockfiles;
  - ensure RSC/SSR/Edge surfaces match guardrails from tasks.

### 9.6 Implementing an AI copilot feature

```bash
/smartspec_implement_tasks \
  specs/ai/spec-ai-010-editor-copilot/tasks.md \
  --index=.spec/SPEC_INDEX.json \
  --registry-dir=.spec/registry \
  --safety-mode=strict \
  --stdout-summary
```

- Implementation must:
  - follow prompt-construction and logging rules from tasks;
  - avoid placing secrets/PII in prompts, logs, or traces;
  - add or extend tests for injection resistance where required.

---

## 10. KiloCode Usage

### 10.1 Orchestrator Mode

```bash
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --kilocode \
  --skip-completed
```

Expected behavior:

- Orchestrator coordinates subtasks per task/phase.
- If Orchestrator is unavailable, the workflow falls back to standard mode and logs a warning.

### 10.2 Standard Mode

Omit `--kilocode` for a simpler execution flow on environments without Orchestrator.

---

## 11. Best Practices

- Treat `tasks.md` as the **contract for implementation**.
- Regenerate `tasks.md` when `spec.md` or `plan.md` change.
- Use `--validate-only` before large implementation runs.
- For production-bound work, use `--safety-mode=strict`.
- Keep SPEC_INDEX and registries updated; run validation workflows regularly.
- Respect UI mode and design system rules; reuse App-level components and design tokens.
- For React/Next/Node/RSC stacks, align dependencies with `tool-version-registry.json`.
- For AI/LLM features, treat models as untrusted and follow tasks’ guardrails exactly.
- Never commit real secrets or PII in code, tasks, or examples.

---

## 12. FAQ (English)

**Q: Can this workflow change `spec.md` or `tasks.md` arbitrarily?**  
A: No. It only updates task checkboxes and possibly adds short notes, following the rules in this manual and your team’s conventions.

**Q: What if SPEC_INDEX is missing?**  
A: The workflow should limit itself to self-contained tasks and report that multi-spec or cross-repo assumptions may be unsafe. In strict mode, treat this as a high-risk condition.

**Q: Do I always need Orchestrator (`--kilocode`)?**  
A: No. Orchestrator is recommended for large or multi-spec runs but is optional. The workflow must fall back gracefully when Orchestrator is not available.

**Q: How does this interact with CI/CD?**  
A: You can wire `/smartspec_implement_tasks` into pipelines that verify `tasks.md` progress, but be careful: in strict mode, missing guardrails or governance artifacts should cause the run to fail or clearly mark the summary as unsafe.

---

---
manual_name: /smartspec_implement_tasks Manual (TH)
manual_version: 5.6
compatible_workflow: /smartspec_implement_tasks
compatible_workflow_versions: 5.6.3 – 5.6.4
role: user/operator manual (tech lead, architect, senior engineer, platform, spec owner)
---

# /smartspec_implement_tasks คู่มือการใช้งาน (v5.6, ภาษาไทย)

## 1. ภาพรวม

คู่มือนี้อธิบายวิธีใช้งาน workflow:

> `/smartspec_implement_tasks v5.6.x` (เช่น v5.6.3 – v5.6.4)

workflow นี้มีหน้าที่ **ลงมือ implement โค้ดจริง ตาม `tasks.md`**  
ซึ่งมาจาก chain:

1. `/smartspec_generate_spec`
2. `/smartspec_generate_plan`
3. `/smartspec_generate_tasks`
4. `/smartspec_implement_tasks`  ← ขั้นตอน implement

เป้าหมายหลัก:

- เปลี่ยน `tasks.md` ให้กลายเป็น **โค้ดและ config ที่จับต้องได้** อย่างปลอดภัย
- เคารพกติกา **centralization & ownership** ของ SmartSpec:
  - ใช้ SPEC_INDEX + registry เป็นแหล่งความจริง
  - ไม่สร้าง API/model/term/UI component ซ้ำกับที่มีอยู่แล้ว
- รองรับ **multi-repo / multi-registry** อย่างปลอดภัย
- Align กับ **UI mode** และ design system:
  - JSON-first UI (`ui.json`) vs inline UI ใน `spec.md`
- ใส่ **guardrail ด้าน web/AI/data**:
  - React/Next.js/RSC/Node/npm (dependency + security)
  - AI/LLM (prompt + logging safety)
  - data-sensitivity / secret / PII
- ใช้ได้ดีกับ **KiloCode** (`--kilocode`) + Orchestrator ถ้ามี

> **สำคัญ:**
> - workflow นี้มี `write_guard: ALLOW-WRITE` แต่เขียนได้เฉพาะใน **repo ปัจจุบัน** เท่านั้น
> - repo พี่น้องที่เจอจาก `--workspace-roots`/`--repos-config` ต้องถือเป็น read-only เสมอ
> - ห้ามแก้ `spec.md` หรือ `tasks.md` แบบทำลาย chain (อนุญาตเฉพาะ update checkbox / note ตามกติกา)

---

## 2. What’s New ใน v5.6

คู่มือนี้ขยายจากคู่มือเวอร์ชันเก่า โดยยังรักษา behavior เดิมทั้งหมดไว้

### 2.1 Align กับ chain v5.6

- สมมติว่า `tasks.md` ถูกสร้างจาก `/smartspec_generate_tasks v5.6.x`
- คาดหวังว่าใน `tasks.md` จะมี:
  - task ID + subtask (`T001.1`, `T001.2`, ...)
  - metadata เรื่อง reuse/create + เจ้าของใน registry
  - hint เรื่อง UI/web/AI/data guardrail

### 2.2 Canonical index & registries

- ใช้ **SPEC_INDEX + registry** ใต้ `.spec/` เป็นแหล่งหลัก:
  - `.spec/SPEC_INDEX.json` คือ canonical index
  - `.spec/registry/` คือ primary registry
- ยังรองรับ mirror เก่า เช่น root `SPEC_INDEX.json` แต่ `.spec/` ถือเป็น source-of-truth

### 2.3 Multi-repo / multi-registry

- เพิ่ม/เน้น flag:
  - `--index`, `--specindex`
  - `--registry-dir`, `--registry-roots`
  - `--workspace-roots`, `--repos-config`
- กติกา:
  - repo ปัจจุบัน: เขียนโค้ด + update tasks ได้
  - repo อื่น: read-only เสมอ
  - ถ้า owner ของ API/model อยู่ repo อื่น → ต้อง implement เป็น integration/client ไม่ใช่สร้างซ้ำ

### 2.4 Safety mode & report

- เพิ่ม `--safety-mode=<strict|dev>` + alias `--strict`
- เพิ่ม `--report-dir`, `--stdout-summary` ให้สร้าง report ใต้ `.spec/reports/implement-tasks/` (หรือ path ที่กำหนด)
- สนับสนุนการใส่ `safety_status` ในสรุป เพื่อใช้ใน CI/gate

### 2.5 Guardrail สำหรับ Web / AI / Data

- ถ้า tasks แตะ React/Next.js/RSC/Node/npm:
  - ควรอ่าน `tool-version-registry.json` ถ้ามี
  - หลีกเลี่ยง downgrade หรือติดตั้ง version ที่ policy ไม่อนุญาต
  - ใส่ task หรือทำ action เรื่อง lockfile, SCA, `npm audit` ฯลฯ ตามที่ tasks ระบุไว้
- ถ้ามี AI/LLM:
  - ปฏิบัติตามกติกา prompt/logging ที่อยู่ใน spec/tasks
  - หลีกเลี่ยง secret/PII ใน prompt & log
- ถ้ามี data อ่อนไหว:
  - เคารพ data classification + masking ตาม spec/tasks

### 2.6 KiloCode & Orchestrator

- `--kilocode` ใช้เปิด Orchestrator mode ถ้าสภาพแวดล้อมรองรับ
- ถ้า Orchestrator ใช้งานไม่ได้ → ต้อง fallback เป็น standard mode พร้อม warning ชัดเจน

---

## 3. Backward Compatibility

- behavior เดิมจากคู่มือ `/smartspec_implement_tasks` เก่า **ยังใช้งานได้ทั้งหมด** เช่น:
  - flag เลือก task: `--task`, `--tasks`, `--range`, `--from`, `--skip-completed`, `--resume`
  - phase filter: `--phase`, `--phases`, `--phase-range`
  - `--validate-only` สำหรับ run แบบ read-only
  - กติกา update checkbox และ final summary
- สิ่งที่เพิ่มเข้ามาใน v5.6 เป็น **ส่วนเสริม**:
  - multi-repo/multi-registry flags
  - safety-mode flags
  - report flags
  - guardrail ด้าน web/AI/data
- ไม่มีการลบ flag หรือ feature เก่า

---

## 4. แนวคิดหลัก (Core Concepts)

### 4.1 ตำแหน่งของ workflow นี้ใน chain

- `spec.md` = ข้อกำหนด (requirements)
- `plan.md` = แผนงาน/phase/sequence (ถ้ามี)
- `tasks.md` = งานที่ implement ได้จริง
- `/smartspec_implement_tasks` = ลงมือเปลี่ยนโค้ด/config ให้ตรงกับ `tasks.md`

### 4.2 SPEC_INDEX & registry

- `SPEC_INDEX`:
  - ใช้ map spec ID → path + dependency
- registry:
  - API, data model, glossary, UI component, pattern, tool-version ฯลฯ
- การ implement ต้องอิงสิ่งเหล่านี้เพื่อ **ไม่สร้างของซ้ำ**

### 4.3 Multi-repo

- `--workspace-roots`, `--repos-config` ทำให้ workflow มองเห็น repo อื่นได้
- กติกา:
  - repo ปัจจุบัน: implement ได้ (เขียนโค้ด/แก้ไฟล์)
  - repo อื่น: read-only เสมอ
  - ถ้า owner ของ entity อยู่ repo อื่น → สร้าง client/integration / adapter แทนที่จะสร้างของใหม่

### 4.4 Evidence-first implementation

ก่อนจะสร้างของใหม่ควร:

1. อ่าน spec + tasks ที่เกี่ยวข้อง
2. ดู owner จาก SPEC_INDEX + registry
3. ค้นหาโค้ดที่มีอยู่แล้วใน repo:
   - middleware, guard, API client/gateway, model, UI component
4. สร้างของใหม่เฉพาะเมื่อ:
   - ไม่มี owner และ
   - ไม่มี definition ที่ขัดแย้งใน codebase/registry

### 4.5 UI JSON vs inline UI

- ถ้าเป็น **JSON-first UI**:
  - `ui.json` ทำหน้าที่เป็น design source-of-truth
  - implement โดย binding/ใช้ component ให้ตรง ui.json และห้าม embed business logic ใน JSON
- ถ้าเป็น **inline UI**:
  - อิงคำอธิบายใน `spec.md`
  - ยังต้องเคารพ design tokens, App components, patterns

### 4.6 Safety modes

- `strict`:
  - ใช้กับงาน production/CI gate
  - ถ้า context governance สำคัญหาย (index/registry/tool-version policy ฯลฯ) ต้องถือเป็น risk สูงและรายงานชัด
- `dev`:
  - ใช้สำหรับ local dev, sandbox, POC
  - อนุโลม context ไม่ครบ แต่ต้องมี warning + บอกว่าผลลัพธ์ไม่เหมาะใช้ gating prod โดยตรง

### 4.7 Guardrail Web/AI/Data

- React/Next/Node/RSC = surface เสี่ยง → ต้องทำตาม task เรื่อง version, security, boundary
- AI/LLM = model untrusted → ต้องทำตาม rule prompt/logging/injection
- data อ่อนไหว = ต้องทำตาม classification/masking rule จาก spec/tasks

---

## 5. ใช้ `/smartspec_implement_tasks` เมื่อไหร่

ใช้ workflow นี้เมื่อ:

- มี `tasks.md` และอยาก implement **บางส่วน** อย่างปลอดภัย
- อยากได้การ implement แบบ **evidence-first** ที่ไม่ฟุ้งและไม่สร้างของซ้ำ
- อยากจำกัด scope ให้แคบ:
  - เลือกเฉพาะ task เดียว / หลาย task / ช่วง / phase / resume
- อยากจบ run ด้วย **สรุปงาน** ที่อ่านง่าย

ไม่ควรใช้เมื่อ:

- `tasks.md` ไม่อัปเดตให้ทัน `spec.md` / `plan.md` → ควร regenerate tasks ก่อน
- จะปรับ spec → ใช้ `/smartspec_generate_spec`
- จะ regenerate tasks → ใช้ `/smartspec_generate_tasks`

---

## 6. Input & Output

### 6.1 Input หลัก

- path ของ `tasks.md` เช่น:

```bash
/smartspec_implement_tasks specs/feature/spec-005-promo-system/tasks.md
```

### 6.2 Input เสริม

- `spec.md`, `plan.md` (ถ้ามี) จะ locate จากโครงโฟลเดอร์เดียวกัน
- SPEC_INDEX + registry จะหาแบบ canonical หรือใช้ `--index`/`--registry-dir` กำหนดเอง

### 6.3 Output

- โค้ดและ config ที่เปลี่ยนตาม task
- update checkbox ใน `tasks.md` เฉพาะ task ที่ทำเสร็จแล้ว
- note เสริม (ถ้า culture ทีมอนุญาต)
- final summary สั้น ๆ:
  - task ที่พยายามทำ
  - task ที่สำเร็จ
  - ไฟล์ที่แก้/สร้างใหม่
  - risk/blocker
  - คำแนะนำขั้นถัดไป
- report ใต้ `.spec/reports/implement-tasks/` (หรือ `--report-dir`)

---

## 7. CLI & Flags (ภาษาไทย)

### 7.1 คำสั่งพื้นฐาน

```bash
/smartspec_implement_tasks <path/to/tasks.md>
```

### 7.2 เลือก task

- `--task=<n>`
- `--tasks=<n1,n2,...>`
- `--range=<start-end>`
- `--from=<n>`
- `--skip-completed`
- `--resume`

ใช้เพื่อควบคุมว่า run นี้จะทำงานกับ task หมายเลขใดบ้าง

### 7.3 Phase filtering

- `--phase=<n>`
- `--phases=<n1,n2,...>`
- `--phase-range=<n1-n2>`

มักใช้คู่กับ `--skip-completed` สำหรับเดิน phase ทีละชุด

### 7.4 Safety & validation

- `--validate-only`
  - run แบบ read-only: ไม่แตะโค้ด ไม่เช็ค checkbox
- `--safety-mode=<strict|dev>`
- `--strict` (alias ของ `--safety-mode=strict`)

ใน strict mode ถ้า context governance สำคัญหายไป ควรถือเป็น risk สูงและสะท้อนใน summary/report

### 7.5 Index / registry / multi-repo

- `--index=<path>` / `--specindex=<path>`
- `--registry-dir=<path>`
- `--registry-roots=<dir1,dir2,...>`
- `--workspace-roots=<dir1,dir2,...>`
- `--repos-config=<path>`

ใช้เมื่อต้องการชี้ index/registry ชุดเฉพาะ (เช่น monorepo ที่มีหลาย `.spec/`)

### 7.6 Reporting & orchestration

- `--report-dir=<path>`
  - เปลี่ยน path default ของ report
- `--stdout-summary`
  - ให้พิมพ์สรุปสั้น ๆ ทาง stdout
- `--kilocode`
  - พยายามใช้ Orchestrator-mode ถ้าสภาพแวดล้อมรองรับ

---

## 8. กติกา Checkbox & Summary

### 8.1 Checkbox

เช็ค task ว่าเสร็จได้ก็ต่อเมื่อ:

- งานโค้ด/config ตามที่ระบุใน task ทำครบแล้ว
- Acceptance criteria (ใน task/spec) ผ่าน
- test ที่ต้องมี ถูกเพิ่ม/อัปเดตแล้ว

ถ้ายังทำไม่ครบ:

- อย่าเช็คกล่อง
- สามารถใส่ note สั้น ๆ ว่าขาดอะไรอยู่ (ถ้าวัฒนธรรมทีม OK)

### 8.2 Final summary

ทุก run ต้องจบด้วย summary ที่บอกอย่างน้อยว่า:

- task ที่พยายามทำ
- task ที่สำเร็จ
- ไฟล์ที่แก้/สร้าง
- risk หรือ blocker
- คำแนะนำ command ถัดไป (เช่น resume, validate-only, run tests)

---

## 9. Use Case ตัวอย่าง

### 9.1 Implement เฉพาะ Phase 1

```bash
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --phase=1 \
  --skip-completed
```

- ทำเฉพาะ task ใน Phase 1
- ข้าม task ที่เช็คแล้ว

### 9.2 ทำทีละช่วงด้วย Orchestrator

```bash
# Chunk แรก
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --range=1-6 \
  --skip-completed \
  --kilocode

# รอบถัดไป (resume)
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --resume
```

### 9.3 validate-only (ไม่แก้โค้ด)

```bash
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --phase=1 \
  --validate-only
```

ใช้เช็ค scope/guardrail ว่าดูสมเหตุสมผลก่อนค่อย implement จริง

### 9.4 Multi-repo ขึ้นกับ platform owner

```bash
/smartspec_implement_tasks \
  specs/payments/spec-pay-010-refund-service/tasks.md \
  --index=../platform/.spec/SPEC_INDEX.json \
  --registry-dir=.spec/registry \
  --registry-roots="../platform/.spec/registry" \
  --workspace-roots="../platform;../billing" \
  --repos-config=.spec/smartspec.repos.json \
  --safety-mode=strict \
  --stdout-summary
```

- ให้ owner ของ API/model ที่อยู่ใน platform repo เป็นแหล่งอ้างอิง
- repo ปัจจุบัน implement เฉพาะ integration/client

### 9.5 Implement ฟีเจอร์ Next.js UI

```bash
/smartspec_implement_tasks \
  specs/web/spec-web-020-account-settings/tasks.md \
  --index=.spec/SPEC_INDEX.json \
  --registry-dir=.spec/registry \
  --safety-mode=strict \
  --stdout-summary
```

- ต้องดู `tool-version-registry.json` ถ้ามี
- ดูแล lockfile, dependency hygiene, RSC/SSR/Edge ตามที่ task ระบุ

### 9.6 Implement ฟีเจอร์ AI copilot

```bash
/smartspec_implement_tasks \
  specs/ai/spec-ai-010-editor-copilot/tasks.md \
  --index=.spec/SPEC_INDEX.json \
  --registry-dir=.spec/registry \
  --safety-mode=strict \
  --stdout-summary
```

- ต้องทำตาม rule prompt/logging/injection ที่อยู่ใน task
- ห้ามแปะ secret/PII ลง prompt/log/trace
- เพิ่ม test ด้าน injection-resistance ตามความเสี่ยง

---

## 10. การใช้ KiloCode

### 10.1 Orchestrator-mode

```bash
/smartspec_implement_tasks \
  specs/feature/spec-004-financial-system/tasks.md \
  --kilocode \
  --skip-completed
```

- Orchestrator จะช่วยแตก subtasks ตาม phase/หมวดงาน
- ถ้า Orchestrator ใช้งานไม่ได้ → ต้อง fallback เป็น standard mode พร้อม warning

### 10.2 Standard mode

- ถ้าละ `--kilocode` ออก จะทำงานแบบโหมดปกติ (เหมาะกับ environment ที่ไม่มี Orchestrator)

---

## 11. Best Practices (TH)

- มอง `tasks.md` เป็น **สัญญาในการ implement**
- ถ้าแก้ `spec.md` หรือ `plan.md` → ควร regenerate `tasks.md` ก่อน implement
- ใช้ `--validate-only` ก่อน run ใหญ่ ๆ
- งานที่ไป production ควรใช้ `--safety-mode=strict`
- ดูแล SPEC_INDEX + registry ให้ทันสมัย
- เคารพ UI mode + design system (ใช้ App component + design token)
- Stack React/Next/Node/RSC ให้ align กับ `tool-version-registry.json`
- ฟีเจอร์ AI/LLM ให้ treat model เป็น untrusted และทำตาม guardrail ใน task อย่างเคร่งครัด
- ห้ามใช้ secret/PII จริงในโค้ด, tasks, example commit

---

## 12. FAQ (ภาษาไทย)

**ถาม: workflow นี้แก้ `spec.md` หรือ `tasks.md` ได้แค่ไหน?**  
ตอบ: แก้ `tasks.md` ได้เฉพาะ checkbox/โน้ตตามกติกาเท่านั้น ไม่ควรปรับโครงหรือความหมายของ task เอง

**ถาม: ถ้าไม่มี SPEC_INDEX เลยจะทำยังไง?**  
ตอบ: ควรจำกัด scope ให้เป็น task แบบ self-contained และรายงานว่าการอ้างอิงข้าม spec อาจไม่ปลอดภัย โดยเฉพาะใน strict mode ควรมองเป็น risk สูง

**ถาม: ต้องใช้ Orchestrator (`--kilocode`) เสมอไหม?**  
ตอบ: ไม่จำเป็น แค่แนะนำสำหรับงานใหญ่หรือหลาย spec ถ้า Orchestrator ใช้งานไม่ได้ ระบบต้อง fallback เป็น standard mode แบบสุภาพ

**ถาม: ใช้ใน CI/CD ยังไงดี?**  
ตอบ: สามารถใช้ตรวจ progress `tasks.md` ใน pipeline ได้ แต่ใน strict mode ถ้า index/registry/guardrail ไม่ครบ ควร fail run หรืออย่างน้อย mark summary ว่า UNSAFE/DEV-ONLY เพื่อไม่ให้หลุดไป production โดยไม่ review

---

