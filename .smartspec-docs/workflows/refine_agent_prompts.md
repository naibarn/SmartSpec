_**Note:** This is the user manual for the `smartspec_refine_agent_prompts` workflow. For the technical workflow definition, please see [`.smartspec/workflows/smartspec_refine_agent_prompts.md`](../../.smartspec/workflows/smartspec_refine_agent_prompts.md)._

# Workflow: smartspec_refine_agent_prompts

## 1. Overview

The `smartspec_refine_agent_prompts` workflow introduces a powerful **AI feedback loop** into your development process. It closes the gap between UI generation and real-world usage by analyzing UI analytics data to provide actionable suggestions for improving your AI agent prompts. By learning from user behavior and performance metrics, this workflow helps you continuously enhance the quality, usability, and effectiveness of your A2UI-generated applications.

This workflow is a key component of a data-driven development cycle, transforming raw analytics into intelligent prompt engineering.

## 2. The AI Feedback Loop

This workflow operates on a simple yet powerful principle: **learn from data, refine prompts, and improve outcomes.**

1.  **Collect Data:** The process begins with analytics data generated by the `smartspec_ui_analytics_reporter` workflow. This data contains valuable metrics on component usage, user interactions, performance, and accessibility.
2.  **Analyze Patterns:** The `smartspec_refine_agent_prompts` workflow ingests this data and uses its built-in intelligence to detect patterns and identify common problems. For example, it might find that a certain type of button has a very low click-through rate or that many images are missing alt text.
3.  **Generate Suggestions:** For each identified issue, the workflow generates a specific, actionable suggestion for refining the AI agent prompts that likely produced that UI. These suggestions include a clear explanation of the problem, a proposed refinement to the prompt, and the expected impact.
4.  **Apply and Iterate:** You can review these suggestions and apply them to your prompt templates. Over time, this iterative process leads to higher-quality prompts that generate more effective and user-friendly UI specifications from the start.

## 3. Parameters

The workflow can be configured using the following parameters.

### Required Parameters

| Parameter | Type | Description |
| :--- | :--- | :--- |
| `--analytics-file` | string | The path to the analytics JSON file generated by `smartspec_ui_analytics_reporter`. |

### Optional Parameters

| Parameter | Type | Description | Default |
| :--- | :--- | :--- | :--- |
| `--focus-area` | string | The specific area to focus the analysis on (e.g., `accessibility`, `performance`). | `all` |
| `--output-format` | string | The format for the output report (`markdown`, `json`, or `both`). | `markdown` |
| `--output-file` | string | The path to save the generated report. | `.spec/prompt_refinements.md` |
| `--threshold` | number | The confidence threshold (0.0-1.0) for suggestions. Only suggestions with a confidence score above this value will be included. | `0.7` |
| `--include-examples` | boolean | Whether to include before-and-after examples in the suggestions. | `true` |
| `--auto-apply` | boolean | If set to `true`, the workflow will attempt to automatically apply high-confidence refinements to your prompt templates. | `false` |

### Focus Areas

You can narrow the analysis to a specific area of interest:

- **`accessibility`**: Focuses on issues related to WCAG compliance, such as missing alt text and low color contrast.
- **`performance`**: Analyzes metrics like load time and component complexity to suggest optimizations.
- **`engagement`**: Looks at user interaction data, such as click rates, to improve calls-to-action and interactivity.
- **`usability`**: Identifies issues that affect user experience, such as high error rates in forms or inconsistent styling.
- **`all`**: Analyzes all areas simultaneously.

## 4. Example Usage

Hereâ€™s how you can use this workflow to improve your prompts.

### Use Case 1: General Analysis

To get a comprehensive report on all potential prompt improvements based on your latest analytics.

**Command:**
```bash
/smartspec_refine_agent_prompts \
  --analytics-file .spec/analytics/ui_analytics_latest.json
```

**Result:** A detailed markdown report is generated at `.spec/prompt_refinements.md`, containing a prioritized list of suggestions across all focus areas.

### Use Case 2: Focusing on Accessibility

Suppose a recent audit revealed accessibility issues. You can use the workflow to generate prompts that produce more accessible UI from the start.

**Command:**
```bash
/smartspec_refine_agent_prompts \
  --analytics-file .spec/analytics/ui_analytics_latest.json \
  --focus-area accessibility \
  --threshold 0.8
```

**Result:** The report will only include high-confidence (>= 0.8) suggestions specifically related to improving accessibility. For example:

```markdown
## Accessibility Refinement Suggestions

### Issue: Missing Alt Text (40% of images)
**Description:** A significant number of images in the application are missing descriptive alt text, making them inaccessible to users with screen readers.

**Current Prompt Pattern:**
"Generate a product card with an image of the product."

**Refined Prompt:**
"Generate a product card with an image of the product. IMPORTANT: Include descriptive alt text for the image that clearly describes its content and purpose, following WCAG 2.1 guidelines."

**Expected Impact:** +40% accessibility score
**Confidence:** 0.95
```

### Use Case 3: Automated Weekly Refinements

For a truly continuous improvement cycle, you can schedule this workflow to run weekly and automatically apply the most reliable suggestions.

**Command (for a cron job):**
```bash
/smartspec_refine_agent_prompts \
  --analytics-file .spec/analytics/ui_analytics_weekly.json \
  --output-format json \
  --auto-apply true \
  --threshold 0.9
```

**Result:** The workflow runs, and any suggestion with a confidence score of 0.9 or higher is automatically applied to the relevant prompt templates, ensuring your AI agents are always learning and improving.

## 5. Understanding the Output

Each suggestion in the report provides clear, actionable information:

- **Issue Description:** A plain-language explanation of the problem identified from the analytics data.
- **Current Prompt Pattern:** An example of the type of prompt that is likely causing the issue.
- **Refined Prompt:** A concrete, improved version of the prompt designed to address the issue.
- **Expected Impact:** A prediction of the positive outcome you can expect from applying the refinement.
- **Confidence Score:** A score from 0.0 to 1.0 indicating how confident the workflow is that this refinement will solve the problem.

## 6. Related Workflows

- **`smartspec_ui_analytics_reporter`**: The source of the data. This workflow must be run first to collect the analytics that `smartspec_refine_agent_prompts` analyzes.
- **`smartspec_ui_performance_test`**: Provides detailed performance metrics that can be fed into the analytics reporter.
- **`smartspec_ui_accessibility_audit`**: Generates accessibility scores that are a key input for this workflow.
