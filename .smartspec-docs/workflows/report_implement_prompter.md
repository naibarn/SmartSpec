# SmartSpec Workflow Manual
## `/smartspec_report_implement_prompter`
### Version 1.0.2 — English Edition

---

## 1. Overview
`/smartspec_report_implement_prompter` is a SmartSpec utility workflow designed to convert strict verification reports into **actionable implementation prompts** suitable for IDE copilots (such as Kilo Code, Claude Code, or Google Antigravity).

Instead of repeatedly running implementation workflows that may not address the root causes of incomplete tasks, this workflow analyzes:

- The **strict verifier JSON report** generated by `/smartspec_verify_tasks_progress_strict`
- The corresponding **spec.md** and **tasks.md**

…and produces:

- A **summary README** of implementation gaps
- One or more **cluster-specific prompt files** (API / Tests / Documentation / Deployment) for engineers to paste into their AI coding tools

This results in highly-targeted, accurate implementation sessions that resolve the exact issues reported by the strict verifier.

---

## 2. Key Features
### ✔ Reads strict verification JSON reports
Understands verdicts, missing evidence, phases, tasks, clusters, and critical components.

### ✔ Generates actionable prompts
Creates Markdown prompt files describing the exact implementation work needed.

### ✔ Supports domain clustering
Automatically groups tasks into:
- API
- Tests
- Documentation
- Deployment

### ✔ Identifies simple vs. complex tasks
- Simple missing tasks → recommends `/smartspec_implement_tasks`
- Complex tasks → generates detailed prompts

### ✔ Multi-repo aware
Supports `--workspace-roots` and `--repos-config` flags.

### ✔ Supports stack detection
Adapts prompt language for Fastify, NestJS, Spring Boot, FastAPI, Go, etc.

### ✔ Optional JSON output
For integration with IDE panels or SmartSpec UI.

### ✔ Includes traceability metadata
Each prompt includes generation ID, timestamp, spec ID, and strict report version.

---

## 3. Typical Workflow

### Step 1 — Run Strict Verification
```bash
/smartspec_verify_tasks_progress_strict \
  --spec specs/feature/<spec-id>/spec.md \
  --report-format=json \
  --report .spec/reports/verify-tasks-progress/<spec-id>-verification-report.json
```

### Step 2 — Generate Implementation Prompts
```bash
/smartspec_report_implement_prompter \
  --spec specs/feature/<spec-id>/spec.md \
  --tasks specs/feature/<spec-id>/tasks.md \
  --report .spec/reports/verify-tasks-progress/<spec-id>-verification-report.json \
  --output .smartspec/prompts/<spec-id>/
```

### Step 3 — Use the prompts in your IDE AI assistant
Open the generated files such as:
- `api-implementation-prompt.md`
- `testing-prompt.md`
- `documentation-prompt.md`
- `deployment-prompt.md`

Copy the content into your coding assistant and let it implement the missing work.

### Step 4 — Verify Again
After implementing:
```bash
/smartspec_verify_tasks_progress_strict --spec specs/feature/<spec-id>/spec.md
```

### Step 5 — Sync Checkbox State
```bash
/smartspec_sync_tasks_checkboxes \
  --tasks specs/feature/<spec-id>/tasks.md \
  --report .spec/reports/verify-tasks-progress/<spec-id>-verification-report.json \
  --mode=auto
```

---

## 4. CLI Reference

```bash
/smartspec_report_implement_prompter \
  --spec <path/to/spec.md> \
  --tasks <path/to/tasks.md> \
  --report <path/to/strict-json-report> \
  [--output <directory>] \
  [--cluster api|tests|docs|deploy|all] \
  [--workspace-roots <paths>] \
  [--repos-config <path>] \
  [--evidence-config <path>] \
  [--language th|en] \
  [--dry-run] \
  [--format markdown|json] \
  [--max-tasks-per-prompt N] \
  [--max-chars-per-prompt N]
```

### Required Flags
| Flag | Description |
|------|-------------|
| `--spec` | Path to the SPEC document. |
| `--tasks` | Path to the TASKS document. |
| `--report` | Strict JSON report path. |

### Optional Flags
| Flag | Purpose |
|------|---------|
| `--output` | Where prompt files will be written. |
| `--cluster` | Generate prompts only for specific domains. |
| `--workspace-roots` | Required in multi-repo setups. |
| `--repos-config` | Multi-repo path resolver file. |
| `--evidence-config` | Custom evidence rules. |
| `--language` | Output language (`en` or `th`). |
| `--dry-run` | Show what *would* be generated. |
| `--format` | Markdown or JSON outputs. |

---

## 5. Output Structure
If `--output` is provided, the workflow produces:
```
.smartspec/prompts/<spec-id>/
  ├── README.md
  ├── api-implementation-prompt.md
  ├── testing-prompt.md
  ├── documentation-prompt.md
  ├── deployment-prompt.md
```

If cluster files exceed size limits, the workflow auto-splits:
```
  testing-prompt-1.md
  testing-prompt-2.md
```

If no tasks require implementation:
```
  README.md (summary only)
```

---

## 6. Task Classification
Each task is categorized into:

### ✔ `unsynced_only`
- Implementation is complete
- Only checkbox state mismatched
- Solution → `/smartspec_sync_tasks_checkboxes`

### ✔ `simple_not_started`
- No partial evidence
- Phase is not started
- Not critical
- Solution → `/smartspec_implement_tasks`

### ✔ `complex_cluster`
Tasks requiring prompt generation:
- Appears in `critical_missing_components`
- Missing evidence in API/tests/docs/deploy
- Complex or ambiguous requirements
- Clustered by domain

---

## 7. Domain Clusters
Tasks are mapped into clusters:

| Cluster | Meaning |
|---------|---------|
| **api** | Missing routes, controllers, handlers, services |
| **tests** | Missing unit/integration/performance tests |
| **docs** | Missing OpenAPI/Swagger or technical documentation |
| **deploy** | Missing Kubernetes manifests, monitoring, infra configs |

A project may override cluster mapping through:
```
.smartspec/prompts/cluster-overrides.json
```

---

## 8. Locale Handling
Language selection order:
1. `--language` flag
2. `Language:` header in `spec.md`
3. Ratio of Thai characters in spec/tasks (>20% → Thai)
4. Platform default (Kilo Code → Thai)
5. Default → English

---

## 9. Tech Stack Detection
The workflow analyzes project files to detect frameworks:

- Fastify
- NestJS
- Spring Boot
- FastAPI
- Go (Fiber/Chi/Gin)

Detected stack influences prompt instructions.

Example:
- NestJS → "create controller + service"
- Fastify → "create route handler"
- Spring → "create RestController"

---

## 10. Prompt Metadata
Each generated prompt includes:
```
<!--
Prompt-Generation-ID: <uuid>
Spec-ID: <spec-id>
Report-Version: <strict-report-version>
Generated-At: <timestamp>
-->
```

---

## 11. Example Generated Prompt (Excerpt)

```markdown
# API Implementation Prompt — Phone Verification (T047–T048)

## Context
Spec: specs/feature/spec-002-user-management/spec.md
Tasks: specs/feature/spec-002-user-management/tasks.md
Report: .spec/reports/verify-tasks-progress/spec-002-user-management-verification-report.json
Tech Stack: Fastify + Prisma

## Summary of Gaps
- Missing endpoint: POST /auth/phone/send-otp
- Missing endpoint: POST /auth/phone/verify-otp
- Service exists but routes are not wired

## Instructions for Kilo Code
1. Inspect existing route patterns in `src/routes/`.
2. Add two POST endpoints in `users.routes.ts` following Fastify conventions.
3. Integrate `phoneVerificationService` calls.
4. Update user model with verification timestamp.
5. Add basic integration tests (optional but recommended).

## After Implementation
- Run project tests
- Re-run strict verifier
```

---

## 12. Error Handling
The workflow gracefully handles:
- Missing report file
- Unsupported report version
- Tasks not found in tasks.md
- Empty clusters
- Missing acceptance criteria

Warnings are emitted with actionable suggestions.

---

## 13. Use Cases
### When this workflow is ideal:
- Strict verifier shows many incomplete tasks
- Implementation is complicated
- Multiple domains (API/tests/docs/deploy) need parallel fixes
- `/smartspec_implement_tasks` alone is insufficient

### When not needed:
- All tasks are already complete
- Only checkbox syncing remains

---

## 14. Conclusion
`/smartspec_report_implement_prompter` transforms strict verification reports into powerful IDE-ready prompts, significantly accelerating implementation accuracy and reducing back-and-forth cycles.

This workflow is now the recommended companion tool for addressing strict verification gaps efficiently.

---

End of Manual.

