# /smartspec_sync_tasks_checkboxes Manual (v6.0, English)

## Overview

The `/smartspec_sync_tasks_checkboxes` workflow is a critical utility designed to maintain the integrity and accuracy of task completion status within a SmartSpec project.

**Purpose:** Synchronize `tasks.md` checkbox markers (`[x]` / `[ ]`) to match the completion status determined by the **latest strict verification report** generated by `/smartspec_verify_tasks_progress_strict`.

**Key Constraints:**
1.  **Checkbox-Only:** This workflow modifies *only* the checkbox markers (`[x]` or `[ ]`).
2.  **Preview-First:** It always generates a diff/report before writing.
3.  **Governed Write:** Writing to `tasks.md` only occurs when the `--apply` flag is used.
4.  **No Network:** The workflow is hardened to prevent network access.

**Version:** 6.0.3
**Category:** utility

---

## Usage

This workflow requires two main inputs: the path to the `tasks.md` file and the path to the strict verification report (`summary.json`).

### CLI Usage

Execute the workflow directly from the command line:

```bash
/smartspec_sync_tasks_checkboxes <path/to/tasks.md> \
  --verify-report <path/to/summary.json> \
  [--manual-policy leave|uncheck] \
  [--recompute-parents true|false] \
  [--report-format md|json|both] \
  [--apply] [--json]
```

**Example (Preview Mode):**

```bash
/smartspec_sync_tasks_checkboxes specs/feature_x/tasks.md \
  --verify-report .spec/reports/verify-tasks-progress/run-1234/summary.json
```

**Example (Apply Mode):**

```bash
/smartspec_sync_tasks_checkboxes specs/feature_x/tasks.md \
  --verify-report .spec/reports/verify-tasks-progress/run-1234/summary.json \
  --apply
```

### Kilo Code Usage

The workflow can be invoked within a Kilo Code script or environment. Note the use of the `--kilocode` flag, although its function is often implicit in the Kilo runtime environment.

```bash
/smartspec_sync_tasks_checkboxes.md <path/to/tasks.md> \
  --kilocode \
  --verify-report <path/to/summary.json> \
  [--manual-policy leave|uncheck] \
  [--recompute-parents true|false] \
  [--report-format md|json|both] \
  [--apply] [--json]
```

**Example (Kilo Code Snippet):**

```kilo
# Assuming $TASK_FILE and $REPORT_FILE are defined
EXEC /smartspec_sync_tasks_checkboxes.md $TASK_FILE \
  --kilocode \
  --verify-report $REPORT_FILE \
  --recompute-parents true \
  --apply
```

---

## Use Cases

### Use Case 1: Standard Synchronization and Application

**Scenario:** A developer has run the strict verification workflow, and the report shows that tasks `TSK-001` and `TSK-003` are now verified, while `TSK-002` failed verification. The goal is to update `tasks.md` accordingly.

**Prerequisites:**
1.  `tasks.md` exists with tasks `TSK-001 [ ]`, `TSK-002 [x]`, `TSK-003 [ ]`.
2.  `summary.json` exists, indicating:
    *   `TSK-001`: `status: verified`, `confidence: high`
    *   `TSK-002`: `status: not_verified`
    *   `TSK-003`: `status: verified`, `confidence: high`

**CLI Command:**

```bash
# 1. Preview the changes
/smartspec_sync_tasks_checkboxes specs/module_a/tasks.md \
  --verify-report .spec/reports/verify-tasks/latest/summary.json

# Expected Result (Report): TSK-001 and TSK-003 will change to [x]; TSK-002 will change to [ ].

# 2. Apply the changes
/smartspec_sync_tasks_checkboxes specs/module_a/tasks.md \
  --verify-report .spec/reports/verify-tasks/latest/summary.json \
  --apply
```

**Resulting `tasks.md`:** `TSK-001 [x]`, `TSK-002 [ ]`, `TSK-003 [x]`.

### Use Case 2: Handling Manual Tasks and Parent Roll-up

**Scenario:** A project uses nested tasks. Task `T100` is a parent of `T101` and `T102`. The verification report indicates `T101` is verified, but `T102` requires manual review (`needs_manual`). The policy is to leave manual tasks unchanged.

**Prerequisites:**
1.  `tasks.md` structure:
    ```markdown
    - [ ] T100 Parent Task
      - [ ] T101 Subtask 1
      - [ ] T102 Subtask 2
    ```
2.  `summary.json` indicates:
    *   `T101`: `status: verified`, `confidence: high`
    *   `T102`: `status: needs_manual`

**Kilo Code Command:**

```kilo
# Use manual-policy=leave and enable parent roll-up
EXEC /smartspec_sync_tasks_checkboxes.md ./tasks.md \
  --kilocode \
  --verify-report ./report.json \
  --manual-policy leave \
  --recompute-parents true \
  --apply
```

**Expected Result:**
1.  `T101` changes to `[x]`.
2.  `T102` remains `[ ]` (due to `--manual-policy leave`).
3.  `T100` changes to `[ ]` because not all children (`T102`) are checked.
4.  `summary.json` output will show `T102` counted under `manual_pending`.

### Use Case 3: Staleness Check Failure

**Scenario:** The user attempts to sync using an old verification report. The report contains a fingerprint of the original `tasks.md`, which does not match the current version of `tasks.md` (which was edited manually after the report was generated).

**CLI Command:**

```bash
/smartspec_sync_tasks_checkboxes tasks.md \
  --verify-report old_stale_report.json \
  --apply
```

**Expected Result:** **Hard-fail** with exit code `1`. The workflow detects the fingerprint mismatch and refuses to proceed, preventing synchronization based on stale data. An error message detailing the staleness check failure is outputted.

---

## Parameters

### Positional Arguments

| Parameter | Required | Description |
| :--- | :--- | :--- |
| `tasks_md` | Yes | Path to the Markdown file containing the tasks list. |

### Workflow Flags

| Flag | Required | Default | Description |
| :--- | :--- | :--- | :--- |
| `--verify-report <path>` | Yes | N/A | Path to the strict verifier `summary.json` file. |
| `--manual-policy <leave\|uncheck>` | No | `uncheck` | Policy for handling tasks marked as `needs_manual` in the report. `leave` preserves the current checkbox state; `uncheck` sets it to `[ ]`. |
| `--recompute-parents <true\|false>` | No | `true` | If true, recalculates the status of parent tasks based on the synced status of their children. |
| `--report-format <md\|json\|both>` | No | `both` | Format for the generated reports. |
| `--apply` | No | N/A | If present, the workflow writes the changes to `tasks.md`. Otherwise, it runs in preview mode. |
| `--json` | No | N/A | Output primary report data in JSON format to stdout (often used with `--apply` for programmatic feedback). |

### Universal Flags (Supported)

| Flag | Description |
| :--- | :--- |
| `--config <path>` | Path to the SmartSpec configuration file. |
| `--lang <th\|en>` | Language setting. |
| `--platform <cli\|kilo\|ci\|other>` | Execution platform context. |
| `--out <path>` | Root directory for safe output reports. |
| `--quiet` | Suppress non-essential output. |

---

## Output

The workflow generates