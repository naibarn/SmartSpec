# SmartSpec Workflow: Test Report Analyzer

**Workflow:** `/smartspec_test_report_analyzer`  
**Version:** 6.1.1

## 1. Overview

The Test Report Analyzer is a diagnostic workflow that processes the output from `/smartspec_test_suite_runner`. It provides a higher-level analysis of test failures, helping you quickly identify patterns, classify root causes, and determine the next steps for fixing broken tests.

This is a **reports-only** workflow, making it safe to run in any environment.

## 2. Key Features

- **Failure Classification:** Automatically categorizes test failures (e.g., flaky, deterministic, infrastructure-related).
- **Pattern Recognition:** Summarizes the top failing tests and suites to highlight recurring issues.
- **Actionable Insights:** Extracts key error messages and stack traces to speed up debugging.
- **Trend Analysis:** Provides signals on test health over time (best-effort).
- **Secure and Isolated:** Operates without network access and redacts sensitive information from reports.

## 3. How It Works

1.  **Consumes Test Report:** Takes the run folder from a `/smartspec_test_suite_runner` execution as input.
2.  **Parses Artifacts:** Reads the `summary.json`, `junit.xml`, `stdout.txt`, and `stderr.txt` from the test run.
3.  **Analyzes Failures:** Correlates logs and stack traces with JUnit failure data to classify each failed test.
4.  **Generates Diagnostic Report:** Produces a detailed `report.md` and `summary.json` with its findings, including:
    -   A summary of failure patterns.
    -   A list of the top failing tests.
    -   Excerpts of relevant error logs.
    -   Suggested next steps.

## 4. Usage

This workflow is run after the Test Suite Runner.

### Step 1: Run the Test Suite

```bash
/smartspec_test_suite_runner --run-command "npm test" --out .spec/reports/test-suite-runner/run-456
```

### Step 2: Analyze the Report

```bash
/smartspec_test_report_analyzer --test-report .spec/reports/test-suite-runner/run-456
```

## 5. Input and Flags

- **`--test-report <path>` (Required):** Path to a single run folder generated by `/smartspec_test_suite_runner`.
- **`--mode <normal|strict>` (Optional):** In `strict` mode, the workflow may apply more stringent analysis rules.
- **`--max-log-bytes <int>` (Optional):** Limits the number of bytes read from log files to prevent performance issues.

## 6. Output: Diagnostic Report

The workflow generates a new report in `.spec/reports/test-report-analyzer/`.

### Example Report Snippet

```markdown
### Failure Pattern: Flaky Test

- **Test Case:** `tests/integration/api.test.js > GET /api/users`
- **Classification:** Flaky
- **Reason:** Test failed with a timeout error, which is a common indicator of a flaky test dependent on external services or timing.
- **Log Excerpt:** `Error: Timeout of 2000ms exceeded.`
- **Recommendation:** Increase the test timeout and investigate the test for race conditions or unreliable dependencies.
```

## 7. Use Cases

- **Triage Test Failures:** Quickly understand the root cause of a broken build without manually digging through logs.
- **Identify Flaky Tests:** Automatically flag unreliable tests that are destabilizing your CI pipeline.
- **Improve Debugging Efficiency:** Get straight to the most relevant error messages and stack traces.
