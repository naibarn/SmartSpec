_**Note:** This is the user manual for the `smartspec_validate_golden_tests` workflow. For the technical workflow definition, please see [`.smartspec/workflows/smartspec_validate_golden_tests.md`](../../.smartspec/workflows/smartspec_validate_golden_tests.md)._

# Workflow: smartspec_validate_golden_tests

## 1. Overview

The `smartspec_validate_golden_tests` workflow is a critical component for ensuring the quality, consistency, and compliance of the A2UI JSON output generated by SmartSpec. It provides a robust and automated way to perform regression testing by comparing A2UI JSON output against a suite of **golden test cases**.

Golden tests are a curated collection of reference A2UI JSON files that represent the "gold standard" for various components and layouts. This workflow validates your generated UI specifications against these standards to catch regressions, ensure A2UI v0.8 compliance, and enforce best practices in accessibility and theming.

## 2. What are Golden Test Cases?

Golden test cases are reference files stored in the `.spec/golden_tests/` directory. Each test case is a JSON file that defines:

- **A Test Scenario:** A description of what is being tested (e.g., a basic button, a form with validation).
- **Expected Output:** The exact A2UI JSON structure that is considered correct for that scenario.
- **Validation Rules:** A set of specific rules that the output must adhere to (e.g., `has_accessibility`, `valid_theme_tokens`).
- **Expected Validity:** Whether the test is expected to pass or fail. This is crucial for testing error scenarios.

The SmartSpec framework comes with a comprehensive set of pre-built golden tests covering:
- Basic components
- Forms and validation
- Theming and design tokens
- Complex layouts
- Interactive components
- Data-driven lists
- Common error scenarios

## 3. Key Features

- **Automated Regression Testing:** Automatically detects if new changes have broken existing A2UI JSON output.
- **Comprehensive Validation:** Checks for schema compliance, accessibility, valid theme token usage, and structural integrity.
- **Flexible Test Execution:** Run the entire test suite, or filter by a specific test ID or category.
- **CI/CD Integration:** Supports JUnit XML output, making it easy to integrate into your continuous integration pipelines (e.g., GitHub Actions, Jenkins).
- **Detailed Reporting:** Generates clear and actionable reports in Markdown, JSON, or JUnit format.

## 4. Parameters

The workflow can be customized with the following optional parameters.

| Parameter | Type | Description | Default |
| :--- | :--- | :--- | :--- |
| `--test-id` | string | Runs a single test specified by its ID. | (all tests) |
| `--category` | string | Runs all tests within a specific category (e.g., `forms`, `theming`). | (all tests) |
| `--input-file` | string | Validates a specific A2UI JSON file against the relevant golden tests. | (none) |
| `--theme-file` | string | The path to the `theme.json` file used for validating theme tokens. | `.spec/theme.json` |
| `--verbose` | boolean | If `true`, shows detailed output for each validation check. | `false` |
| `--output-format` | string | The format for the test report (`markdown`, `json`, or `junit`). | `markdown` |
| `--output-file` | string | The path to save the generated test report. | `.spec/test_results.md` |
| `--fail-fast` | boolean | If `true`, the workflow will stop immediately on the first test failure. | `false` |

## 5. Example Usage

Here are some common ways to use this workflow.

### Use Case 1: Running the Full Test Suite

This is the most common use case, typically run before committing code or in a CI pipeline.

**Command:**
```bash
/smartspec_validate_golden_tests
```

**Result:** The workflow executes all golden test cases and generates a summary report (`.spec/test_results.md`) showing the pass/fail status for each test.

### Use Case 2: Integrating with a CI/CD Pipeline

To use this workflow in a CI/CD environment, you can generate a JUnit XML report, which most CI systems can parse to display test results.

**Command:**
```bash
/smartspec_validate_golden_tests \
  --output-format junit \
  --output-file test-results.xml
```

**Result:** A `test-results.xml` file is created in the JUnit format. The workflow will exit with a non-zero status code if any tests fail, which will typically cause the CI pipeline to fail as expected.

### Use Case 3: Debugging a Specific Component

Suppose you are working on form components and want to run only the tests related to forms.

**Command:**
```bash
/smartspec_validate_golden_tests \
  --category forms \
  --verbose true
```

**Result:** The workflow will only execute the tests in the `forms` category and will print detailed, verbose output for each validation rule, making it easier to debug any issues.

### Use Case 4: Pre-Commit Hook

To ensure no regressions are committed, you can use this workflow as a pre-commit hook.

**Command (in a pre-commit script):**
```bash
/smartspec_validate_golden_tests --fail-fast true
```

**Result:** The commit will be aborted if any golden test fails, preventing broken A2UI specifications from entering the codebase.

## 6. Understanding the Test Report

The generated report provides a clear summary of the test run.

- **Summary Statistics:** Shows the total number of tests run, as well as the count of passed, failed, and skipped tests.
- **Summary by Category:** A breakdown of results for each test category.
- **Failed Tests:** A detailed list of all tests that failed, including the specific validation rule that was violated and a description of the error.
- **Passed Tests:** A list of all tests that passed successfully.

**Test Statuses:**
- ✅ **PASS:** The test passed all validation checks.
- ❌ **FAIL:** The test failed a critical validation check.
- ⚠️ **WARN:** The test passed but generated warnings (e.g., an error scenario that was expected to fail did not).
- ⏭️ **SKIP:** The test was not run because it was excluded by a filter.

## 7. Related Workflows

- **`smartspec_generate_ui_spec`**: The output of this workflow is what you would typically validate using `smartspec_validate_golden_tests`.
- **`smartspec_manage_theme`**: This workflow manages the `theme.json` file, which is used by the validation workflow to check for valid theme token references.
