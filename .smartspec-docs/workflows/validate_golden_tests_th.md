_**หมายเหตุ:** นี่คือคู่มือการใช้งานสำหรับเวิร์กโฟลว์ `smartspec_validate_golden_tests` สำหรับคำจำกัดความทางเทคนิคของเวิร์กโฟลว์ โปรดดูที่ [`.smartspec/workflows/smartspec_validate_golden_tests.md`](../../.smartspec/workflows/smartspec_validate_golden_tests.md)_ 

# เวิร์กโฟลว์: smartspec_validate_golden_tests

## 1. ภาพรวม

เวิร์กโฟลว์ `smartspec_validate_golden_tests` เป็นองค์ประกอบที่สำคัญในการรับประกันคุณภาพ, ความสอดคล้อง, และการปฏิบัติตามข้อกำหนดของผลลัพธ์ A2UI JSON ที่สร้างโดย SmartSpec มันมีวิธีการที่แข็งแกร่งและอัตโนมัติในการทำการทดสอบการถดถอย (regression testing) โดยการเปรียบเทียบผลลัพธ์ A2UI JSON กับชุดของ **golden test cases**

Golden tests คือชุดของไฟล์ A2UI JSON อ้างอิงที่ได้รับการดูแลจัดการซึ่งแสดงถึง "มาตรฐานทองคำ" สำหรับคอมโพเนนต์และเลย์เอาต์ต่างๆ เวิร์กโฟลว์นี้จะตรวจสอบ UI specifications ที่คุณสร้างขึ้นกับมาตรฐานเหล่านี้เพื่อจับการถดถอย, รับประกันการปฏิบัติตาม A2UI v0.8, และบังคับใช้แนวทางปฏิบัติที่ดีที่สุดในการเข้าถึงและธีม

## 2. Golden Test Cases คืออะไร?

Golden test cases คือไฟล์อ้างอิงที่เก็บไว้ในไดเรกทอรี `.spec/golden_tests/` แต่ละกรณีทดสอบเป็นไฟล์ JSON ที่กำหนด:

- **สถานการณ์ทดสอบ:** คำอธิบายของสิ่งที่กำลังทดสอบ (เช่น ปุ่มพื้นฐาน, ฟอร์มที่มีการตรวจสอบความถูกต้อง)
- **ผลลัพธ์ที่คาดหวัง:** โครงสร้าง A2UI JSON ที่แน่นอนซึ่งถือว่าถูกต้องสำหรับสถานการณ์นั้น
- **กฎการตรวจสอบ:** ชุดของกฎเฉพาะที่ผลลัพธ์ต้องปฏิบัติตาม (เช่น `has_accessibility`, `valid_theme_tokens`)
- **ความถูกต้องที่คาดหวัง:** การทดสอบคาดว่าจะผ่านหรือล้มเหลว นี่เป็นสิ่งสำคัญสำหรับการทดสอบสถานการณ์ข้อผิดพลาด

เฟรมเวิร์ก SmartSpec มาพร้อมกับชุดของการทดสอบ golden ที่สร้างไว้ล่วงหน้าอย่างครอบคลุมซึ่งครอบคลุม:
- คอมโพเนนต์พื้นฐาน
- ฟอร์มและการตรวจสอบความถูกต้อง
- ธีมและ design tokens
- เลย์เอาต์ที่ซับซ้อน
- คอมโพเนนต์แบบโต้ตอบ
- รายการที่ขับเคลื่อนด้วยข้อมูล
- สถานการณ์ข้อผิดพลาดทั่วไป

## 3. คุณสมบัติหลัก

- **การทดสอบการถดถอยอัตโนมัติ:** ตรวจจับโดยอัตโนมัติว่าการเปลี่ยนแปลงใหม่ได้ทำลายผลลัพธ์ A2UI JSON ที่มีอยู่หรือไม่
- **การตรวจสอบที่ครอบคลุม:** ตรวจสอบการปฏิบัติตาม schema, การเข้าถึง, การใช้ theme token ที่ถูกต้อง, และความสมบูรณ์ของโครงสร้าง
- **การดำเนินการทดสอบที่ยืดหยุ่น:** เรียกใช้ชุดทดสอบทั้งหมด, หรือกรองตาม ID การทดสอบหรือหมวดหมู่ที่ระบุ
- **การผสานรวม CI/CD:** รองรับผลลัพธ์ JUnit XML, ทำให้ง่ายต่อการผสานรวมเข้ากับไปป์ไลน์การผสานรวมอย่างต่อเนื่องของคุณ (เช่น GitHub Actions, Jenkins)
- **การรายงานโดยละเอียด:** สร้างรายงานที่ชัดเจนและนำไปปฏิบัติได้ในรูปแบบ Markdown, JSON, หรือ JUnit

## 4. พารามิเตอร์

เวิร์กโฟลว์สามารถปรับแต่งได้ด้วยพารามิเตอร์ที่ไม่บังคับต่อไปนี้

| พารามิเตอร์ | ประเภท | คำอธิบาย | ค่าเริ่มต้น |
| :--- | :--- | :--- | :--- |
| `--test-id` | string | เรียกใช้การทดสอบเดียวที่ระบุโดย ID | (ทุกการทดสอบ) |
| `--category` | string | เรียกใช้การทดสอบทั้งหมดภายในหมวดหมู่ที่ระบุ (เช่น `forms`, `theming`) | (ทุกการทดสอบ) |
| `--input-file` | string | ตรวจสอบไฟล์ A2UI JSON ที่ระบุเทียบกับ golden tests ที่เกี่ยวข้อง | (ไม่มี) |
| `--theme-file` | string | เส้นทางไปยังไฟล์ `theme.json` ที่ใช้สำหรับตรวจสอบ theme tokens | `.spec/theme.json` |
| `--verbose` | boolean | หากเป็น `true` จะแสดงผลลัพธ์โดยละเอียดสำหรับการตรวจสอบแต่ละครั้ง | `false` |
| `--output-format` | string | รูปแบบสำหรับรายงานการทดสอบ (`markdown`, `json`, หรือ `junit`) | `markdown` |
| `--output-file` | string | เส้นทางที่จะบันทึกรายงานการทดสอบที่สร้างขึ้น | `.spec/test_results.md` |
| `--fail-fast` | boolean | หากเป็น `true` เวิร์กโฟลว์จะหยุดทันทีเมื่อการทดสอบแรกไม่สำเร็จ | `false` |

## 5. ตัวอย่างการใช้งาน

นี่คือวิธีการทั่วไปบางส่วนในการใช้เวิร์กโฟลว์นี้

### กรณีการใช้งานที่ 1: การเรียกใช้ชุดทดสอบทั้งหมด

นี่เป็นกรณีการใช้งานที่พบบ่อยที่สุด, โดยทั่วไปจะทำงานก่อนที่จะคอมมิตโค้ดหรือในไปป์ไลน์ CI

**คำสั่ง:**
```bash
/smartspec_validate_golden_tests
```

**ผลลัพธ์:** เวิร์กโฟลว์จะดำเนินการ golden test cases ทั้งหมดและสร้างรายงานสรุป (`.spec/test_results.md`) ที่แสดงสถานะผ่าน/ไม่ผ่านสำหรับแต่ละการทดสอบ

### กรณีการใช้งานที่ 2: การผสานรวมกับไปป์ไลน์ CI/CD

หากต้องการใช้เวิร์กโฟลว์นี้ในสภาพแวดล้อม CI/CD คุณสามารถสร้างรายงาน JUnit XML ซึ่งระบบ CI ส่วนใหญ่สามารถแยกวิเคราะห์เพื่อแสดงผลการทดสอบได้

**คำสั่ง:**
```bash
/smartspec_validate_golden_tests \
  --output-format junit \
  --output-file test-results.xml
```

**ผลลัพธ์:** ไฟล์ `test-results.xml` จะถูกสร้างขึ้นในรูปแบบ JUnit เวิร์กโฟลว์จะออกด้วยรหัสสถานะที่ไม่ใช่ศูนย์หากการทดสอบใดๆ ไม่สำเร็จ ซึ่งโดยทั่วไปจะทำให้ไปป์ไลน์ CI ล้มเหลวตามที่คาดไว้

### กรณีการใช้งานที่ 3: การดีบักคอมโพเนนต์เฉพาะ

สมมติว่าคุณกำลังทำงานกับคอมโพเนนต์ฟอร์มและต้องการเรียกใช้เฉพาะการทดสอบที่เกี่ยวข้องกับฟอร์ม

**คำสั่ง:**
```bash
/smartspec_validate_golden_tests \
  --category forms \
  --verbose true
```

**ผลลัพธ์:** เวิร์กโฟลว์จะดำเนินการเฉพาะการทดสอบในหมวดหมู่ `forms` และจะพิมพ์ผลลัพธ์โดยละเอียดสำหรับแต่ละกฎการตรวจสอบ ทำให้ง่ายต่อการดีบักปัญหาใดๆ

### กรณีการใช้งานที่ 4: Pre-Commit Hook

เพื่อให้แน่ใจว่าไม่มีการถดถอยใดๆ ถูกคอมมิต คุณสามารถใช้เวิร์กโฟลว์นี้เป็น pre-commit hook ได้

**คำสั่ง (ในสคริปต์ pre-commit):**
```bash
/smartspec_validate_golden_tests --fail-fast true
```

**ผลลัพธ์:** การคอมมิตจะถูกยกเลิกหาก golden test ใดๆ ไม่สำเร็จ, ป้องกันไม่ให้ A2UI specifications ที่เสียหายเข้าสู่ codebase

## 6. การทำความเข้าใจรายงานการทดสอบ

รายงานที่สร้างขึ้นจะให้สรุปที่ชัดเจนของการทดสอบ

- **สถิติสรุป:** แสดงจำนวนการทดสอบทั้งหมดที่ทำงาน, รวมถึงจำนวนที่ผ่าน, ไม่ผ่าน, และข้ามไป
- **สรุปตามหมวดหมู่:** การแบ่งย่อยผลลัพธ์สำหรับแต่ละหมวดหมู่การทดสอบ
- **การทดสอบที่ล้มเหลว:** รายการโดยละเอียดของการทดสอบทั้งหมดที่ล้มเหลว, รวมถึงกฎการตรวจสอบเฉพาะที่ถูกละเมิดและคำอธิบายของข้อผิดพลาด
- **การทดสอบที่ผ่าน:** รายการของการทดสอบทั้งหมดที่ผ่านสำเร็จ

**สถานะการทดสอบ:**
- ✅ **PASS:** การทดสอบผ่านการตรวจสอบทั้งหมด
- ❌ **FAIL:** การทดสอบไม่ผ่านการตรวจสอบที่สำคัญ
- ⚠️ **WARN:** การทดสอบผ่านแต่สร้างคำเตือน (เช่น สถานการณ์ข้อผิดพลาดที่คาดว่าจะล้มเหลวแต่ไม่ล้มเหลว)
- ⏭️ **SKIP:** การทดสอบไม่ได้ทำงานเนื่องจากถูกยกเว้นโดยตัวกรอง

## 7. เวิร์กโฟลว์ที่เกี่ยวข้อง

- **`smartspec_generate_ui_spec`**: ผลลัพธ์ของเวิร์กโฟลว์นี้คือสิ่งที่คุณจะตรวจสอบโดยทั่วไปโดยใช้ `smartspec_validate_golden_tests`
- **`smartspec_manage_theme`**: เวิร์กโฟลว์นี้จัดการไฟล์ `theme.json` ซึ่งใช้โดยเวิร์กโฟลว์การตรวจสอบเพื่อตรวจสอบการอ้างอิง theme token ที่ถูกต้อง
