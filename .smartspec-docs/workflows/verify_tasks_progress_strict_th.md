# /smartspec_verify_tasks_progress_strict คู่มือ (v6.0, ภาษาไทย)

## ภาพรวม

workflow `/smartspec_verify_tasks_progress_strict` เป็นเครื่องมือสำคัญสำหรับการตรวจสอบให้แน่ใจว่างานที่กำหนดไว้ในไฟล์ `tasks.md` นั้นเสร็จสมบูรณ์จริงตามหลักฐานที่ตรวจสอบได้ภายในฐานโค้ด แทนที่จะพึ่งพาแค่การติ๊กถูกในช่องทำเครื่องหมายที่ตรวจสอบด้วยมือ

**วัตถุประสงค์:** ตรวจสอบความก้าวหน้าของ `tasks.md` ที่กำหนดโดยใช้ **การตรวจสอบอย่างเคร่งครัดโดยอ้างอิงเฉพาะหลักฐาน**

**คุณสมบัติหลัก:**
*   พิจารณาช่องทำเครื่องหมายว่าเป็น **ไม่ใช่แหล่งอ้างอิงที่เชื่อถือได้**
*   ตรวจสอบงานผ่านหลักฐานที่ชัดเจน (โค้ด, ทดสอบ, UI, เอกสาร)
*   สร้างรายงานที่ตรวจสอบได้ภายใต้ `.spec/reports/verify-tasks-progress/`
*   ทำงานในโหมด **ปลอดภัยโดยค่าเริ่มต้น** โดยเขียนเฉพาะรายงานเท่านั้น

**เวอร์ชัน:** 6.0.3

## การใช้งาน

workflow นี้ถูกออกแบบมาให้เรียกใช้งานผ่าน command line (CLI) หรือผ่านสภาพแวดล้อม Kilo Code

### การใช้งาน CLI

อินพุตหลักคือเส้นทางไปยังไฟล์ `tasks.md` ที่ต้องการตรวจสอบ

```bash
/smartspec_verify_tasks_progress_strict <path/to/tasks.md> [--report-format <md|json|both>] [--json]
```

**ตัวอย่าง:**

```bash
# ตรวจสอบงานสำหรับสเปค 'feature-orders'
/smartspec_verify_tasks_progress_strict specs/feature-orders/tasks.md --report-format both
```

### การใช้งาน Kilo Code

ในสภาพแวดล้อมที่รองรับการรัน Kilo Code การเรียกใช้งานจะคล้ายกัน โดยใช้ไฟล์ workflow ที่มีนามสกุล `.md`

```bash
/smartspec_verify_tasks_progress_strict.md <path/to/tasks.md> [--report-format <md|json|both>] [--json]
```

**ตัวอย่าง:**

```bash
# ตรวจสอบงานและส่งออกผลลัพธ์ในรูปแบบ JSON เท่านั้น
/smartspec_verify_tasks_progress_strict.md specs/v6/tasks.md --report-format json
```

## กรณีการใช้งาน

### กรณีการใช้งาน 1: การตรวจสอบมาตรฐานและสร้างรายงาน

**สถานการณ์:** นักพัฒนาต้องการตรวจสอบสถานะความเสร็จของงานสำหรับฟีเจอร์ API ใหม่ (`api-v2.md`) และสร้างรายงานทั้งในรูปแบบ markdown ที่อ่านได้โดยมนุษย์ และสรุป JSON ที่อ่านโดยเครื่อง

| รายละเอียด | ค่า |
| :--- | :--- |
| **ไฟล์งาน** | `specs/api-v2/tasks.md` |
| **เป้าหมาย** | สร้างรายงานการตรวจสอบครบถ้วน |

**คำสั่ง (CLI):**

```bash
/smartspec_verify_tasks_progress_strict specs/api-v2/tasks.md --report-format both
```

**ผลลัพธ์ที่คาดหวัง:**

1.  รหัสออก `0`
2.  สร้างโฟลเดอร์รันใหม่ เช่น `.spec/reports/verify-tasks-progress/20240101-123456/`
3.  สร้างไฟล์ดังนี้:
    *   `report.md`: รายงาน markdown รายละเอียดแสดงสถานะงานแต่ละงาน ความมั่นใจ และคำแนะนำแก้ไข
    *   `summary.json`: ไฟล์ JSON ที่มีข้อมูลโครงสร้างเกี่ยวกับผลรวมและผลลัพธ์
4.  รายงานจะเน้นงานที่ขาดหลักฐาน หรือมีหลักฐานชี้ไปยังไฟล์ที่ไม่มีอยู่จริง

### กรณีการใช้งาน 2: การตรวจสอบงานเอกสารเฉพาะ

**สถานการณ์:** นักเขียนเทคนิคต้องการตรวจสอบให้งานเอกสารทั้งหมดในสเปคเสร็จสมบูรณ์ โดยเฉพาะการตรวจสอบการมีอยู่ของไฟล์และหัวข้อที่กำหนดในหลักฐาน `docs` พวกเขาต้องการผลลัพธ์ JSON เท่านั้นเพื่อใช้ใน pipeline CI

| รายละเอียด | ค่า |
| :--- | :--- |
| **ไฟล์งาน** | `specs/docs-migration/tasks.md` |
| **เป้าหมาย** | ตรวจสอบความก้าวหน้าเอกสาร, ส่งออก JSON เท่านั้น |

**คำสั่ง (Kilo Code):**

```bash
/smartspec_verify_tasks_progress_strict.md specs/docs-migration/tasks.md --report-format json --quiet
```

**ผลลัพธ์ที่คาดหวัง:**

1.  รหัสออก `0`
2.  สร้างโฟลเดอร์รันที่มีเฉพาะไฟล์ `summary.json`
3.  ใน `summary.json` จะมีรายการที่หลักฐาน `type: docs` ถูกตรวจสอบกับระบบไฟล์ งานที่พบ `path` และ `heading` ที่ระบุจะถูกทำเครื่องหมายว่า `verified: true` พร้อม `confidence: high`
4.  ข้อความแสดงผลบนคอนโซลจะน้อยลงเนื่องจากใช้ flag `--quiet`

### กรณีการใช้งาน 3: การจัดการขอบเขตไม่ถูกต้องและการปกปิดข้อมูล

**สถานการณ์:** นักพัฒนาพยายามตรวจสอบไฟล์ `tasks.md` ที่มีหลักฐานชี้ไปยังไฟล์นอกขอบเขต workspace ที่อนุญาต (เช่น ใช้ path แบบ absolute หรือ path traversal `../..`) ระบบต้องบังคับใช้นโยบายความปลอดภัย

| รายละเอียด | ค่า |
| :--- | :--- |
| **ไฟล์งาน** | `specs/security-audit/tasks.md` |
| **หลักฐาน** | `evidence: code path=../../secrets/config.yaml` |
| **เป้าหมาย** | ตรวจสอบความปลอดภัยและรายงานขอบเขตไม่ถูกต้อง |

**คำสั่ง (CLI):**

```bash
/smartspec_verify_tasks_progress_strict specs/security-audit/tasks.md
```

**ผลลัพธ์ที่คาดหวัง:**

1.  รหัสออก `0` (ถ้างานอื่นถูกต้อง, หากตรวจสอบล้มเหลวตั้งแต่ต้นจะเป็น `1`)
2.  รายงานถูกสร้างขึ้น
3.  งานที่มีหลักฐานไม่ถูกต้องจะถูกทำเครื่องหมายว่า `status: invalid_scope`
4.  รายงานระบุชัดเจนว่าการอ่านหลักฐานถูกบล็อกเนื่องจาก path traversal/ละเมิดขอบเขต เพื่อให้ workflow ปฏิบัติตาม **สัญญาการกำกับดูแล** และกฎ **ขอบเขตการอ่านหลักฐาน**

## พารามิเตอร์

workflow รับอินพุต positional และ flags ดังนี้:

### อินพุต positional

| พารามิเตอร์ | จำเป็น | คำอธิบาย | การตรวจสอบ |
| :--- | :--- | :--- | :--- |
| `tasks_md` | ใช่ | เส้นทางไปยังไฟล์ `tasks.md` ที่จะตรวจสอบ | ต้องมีอยู่จริง, อยู่ภายใต้ `specs/**` และไม่หลบหนีผ่าน symlink |

### flags ทั่วไป (Standard SmartSpec Flags)

| Flag | ค่าเริ่มต้น | คำอธิบาย |
| :--- | :--- | :--- |
| `--config <path>` | `.spec/smartspec.config.yaml` | เส้นทางไปยังไฟล์คอนฟิก SmartSpec |
| `--lang <th|en>` | (ค่าเริ่มต้นระบบ) | กำหนดภาษาสำหรับข้อความผลลัพธ์ |
| `--platform <cli|kilo|ci|other>` | (อนุมาน) | กำหนดแพลตฟอร์มการรัน |
| `--out <path>` | (เส้นทางรายงานภายใน) | กำหนดไดเรกทอรีผลลัพธ์สำหรับรายงาน ต้องอยู่ในขอบเขตที่อนุญาตให้เขียน |
| `--json` | (ไม่มี) | เป็น alias ของ `--report-format json` เปิดใช้งานผลลัพธ์ JSON สำหรับข้อมูลสรุป |
| `--quiet` | (ไม่มี) | ปิดการแสดงผลที่ไม่จำเป็นบนคอนโซล |

### flags เฉพาะ workflow

| Flag | ค่าเริ่มต้น | คำอธิบาย |
| :--- | :--- | :--- |
| `--report-format <md|json|both>` | `both` | กำหนดรูปแบบของไฟล์รายงานที่สร้าง |

## ผลลัพธ์

workflow นี้ถูกออกแบบมาเพื่อสร้างรายงานที่ตรวจสอบได้ซึ่งแสดงรายละเอียดกระบวนการและผลลัพธ์การตรวจสอบ

### ผลลัพธ์ที่สร้างขึ้น

รายงานทั้งหมดจะถูกเขียนลงในโฟลเดอร์รันที่ไม่ซ้ำกัน โดยปกติอยู่ที่:
`.spec/reports/verify-tasks-progress/<run-id>/`

หากใช้ flag `--out <path>` รายงานจะถูกเขียนลงใน:
`<out>/<run-id>/`

| ชื่อไฟล์ | รูปแบบ | เงื่อนไข | คำอธิบาย |
| :--- | :--- | :--- | :--- |
| `report.md` | Markdown | เมื่อ `--report-format` มีค่า `md` หรือ `both` | รายงานละเอียดที่อ่านโดยมนุษย์ รวมสถานะงานแต่ละงาน ระดับความมั่นใจ และคำแนะนำแก้ไข |
| `summary.json` | JSON | เมื่อ `--report-format` มีค่า `json` หรือ `both` หรือใช้ `--json` | สรุปผลลัพธ์การตรวจสอบในรูปแบบโครงสร้างที่อ่านโดยเครื่อง ตาม schema ที่กำหนด |

### เนื้อหาที่ต้องมีใน `report.md`

รายงาน markdown ต้องประกอบด้วย:

1.  เส้นทางไฟล์เป้าหมายและรหัสสเปคที่แก้ไขแล้ว (`spec-id`)
2.  สรุปผลรวม (Verified Done, Not Verified, Missing Hooks ฯลฯ)
3.  ผลลัพธ์ต่อแต่ละงาน (ID, ชื่อเรื่อง, สถานะ, ความมั่นใจ, หลักฐานอ้างอิง)
4.  รายการช่องว่างของหลักฐานพร้อม **คำแนะนำแก้ไข** ที่ชัดเจน (เทมเพลตสำหรับหลักฐานที่ขาด)
5.  หมายเหตุการปกปิดข้อมูล (ถ้ามี ตามคอนฟิก)
6.  รายการไฟล์ที่สร้างขึ้น
7.  ขั้นตอนถัดไปที่แนะนำ (เช่น วิธีซิงค์ช่องทำเครื่องหมาย)

## หมายเหตุ & workflow ที่เกี่ยวข้อง

### การทำงานแบบไม่ทำลายข้อมูล

workflow นี้เป็นแบบไม่ทำลายข้อมูลอย่างเคร่งครัด ห้าม **แก้ไข** ไฟล์ `tasks.md` หรือซอร์สโค้ดใด ๆ มันจะสร้างรายงานเท่านั้น

### การซิงค์ช่องทำเครื่องหมาย

workflow นี้ตรวจสอบ *ความก้าวหน้า* โดยอ้างอิงหลักฐานเท่านั้น ไม่ได้อัปเดตช่องทำเครื่องหมายใน `tasks.md`

หากต้องการอัปเดตช่องทำเครื่องหมายตามผลการตรวจสอบ ให้ใช้ workflow ที่เกี่ยวข้อง:

*   **`/smartspec_sync_tasks_checkboxes`**: ใช้สำหรับอัปเดตสถานะช่องทำเครื่องหมายใน `tasks.md` อย่างปลอดภัยตามสถานะการตรวจสอบล่าสุด

**ขั้นตอนถัดไปที่แนะนำ:**

หากรายงานการตรวจสอบแสดงว่างานใด ๆ ยังไม่เสร็จสมบูรณ์หรือขาดหลักฐาน ให้ใช้ workflow ซิงค์ช่องทำเครื่องหมายเพื่ออัปเดตสถานะใน `tasks.md` ต่อไป