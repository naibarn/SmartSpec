---
description: Monitor production health, generate alerts, and feed metrics back into the SmartSpec ecosystem.
version: 1.0.0
workflow: /smartspec_production_monitor
---

# smartspec_production_monitor

> **Canonical path:** `.smartspec/workflows/smartspec_production_monitor.md`  
> **Version:** 1.0.0  
> **Status:** New  
> **Category:** production-ops

## Purpose

This workflow provides a bridge between production operations and the SmartSpec ecosystem. It monitors production health, generates alerts for anomalies, and feeds performance metrics back to be used in future spec generation and planning.

This workflow MUST:

- Integrate with common observability platforms (e.g., Prometheus, Datadog, Grafana).
- Track key performance indicators (KPIs) against the NFRs defined in the corresponding `spec.md`.
- Generate alerts when KPIs deviate from their service-level objectives (SLOs).
- Create performance reports that can be fed into the `smartspec_feedback_aggregator`.
- Be highly available and resilient.

---

## Behavior (Vibe Coding)

### Phase 1: Configuration

1.  **Load Spec:** Load the `spec.md` for the deployed service.
2.  **Extract NFRs:** Parse the Non-Functional Requirements (NFRs) section to get the target SLOs (e.g., p99 latency < 200ms, error rate < 0.1%).
3.  **Load Observability Config:** Load the `observability.yaml` generated by `smartspec_observability_configurator` to get the correct metric names and dashboard URLs.

### Phase 2: Monitoring Loop (Continuous)

1.  **Query Metrics:** Periodically query the observability platform's API for the relevant metrics.
2.  **Compare to SLOs:** Compare the current metric values against the target SLOs from the spec.
3.  **Update Health Status:** Maintain a real-time health status for the service.

### Phase 3: Alerting

1.  **If SLO Breach Detected:**
    -   **Generate Alert:** Create a structured alert containing the service name, breached metric, current value, and target value.
    -   **Trigger Incident:** Send the alert to the `smartspec_incident_response` workflow to initiate the incident management process.

### Phase 4: Reporting

1.  **Generate Performance Report:** On a schedule (e.g., daily, weekly), generate a summary report of performance against SLOs.
2.  **Save Report:** Save the report in a structured format (e.g., JSON) in `.spec/reports/production-monitoring/`.
3.  **Notify Feedback Aggregator:** Trigger the `smartspec_feedback_aggregator` to process the new performance report.

---

## Governance contract

- This workflow MUST have read-only access to production metrics.
- It MUST NOT have write access to any production systems.
- All API keys and credentials for observability platforms MUST be stored securely and never logged.

---

## Invocation

```bash
/smartspec_production_monitor \
  --spec-id <spec-id> \
  [--run-once] \
  [--daemon]
```

---

## Inputs

- `--spec-id <spec-id>`: The ID of the spec to monitor.
- `--run-once`: Run the monitoring check once and exit.
- `--daemon`: Run continuously as a background process.

---

## Output

- **Alerts:** Sent to `smartspec_incident_response`.
- **Reports:** Saved in `.spec/reports/production-monitoring/`.
- **Logs:** Standard monitoring logs.
