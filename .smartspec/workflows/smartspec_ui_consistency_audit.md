---
name: /smartspec_ui_consistency_audit
version: 5.6.4
role: verification/governance
write_guard: NO-WRITE
purpose: Audit UI implementation for consistency with the design
         system, design tokens, brand guidelines, and UI specs
         (including JSON-first UI generated by AI), without modifying
         code, configs, or running tests.
version_notes:
  - v5.6.2: initial workflow spec
  - v5.6.4: aligned with governance/KB v5.6+; documentation-only update, no behavior change
---

## 1) Summary

`/smartspec_ui_consistency_audit` reads SmartSpec artifacts, UI specs
(including JSON-first UI definitions), design system registries, and UI
implementation structure to produce a **UI consistency audit report**.

It focuses on:

- checking consistency of:
  - design token usage (colors, typography, spacing, radius, shadows)
  - component and pattern usage (buttons, forms, dialogs, navigation)
  - state handling (hover, focus, disabled, loading)
  - theming (light/dark mode, per-brand themes)
  - naming conventions (components, tokens, variants)
- across screens/routes/flows defined in UI specs / UI JSON
- with special attention to **AI-generated `ui.json`**:
  - origin (AI vs human vs mixed)
  - declared design system version and style preset
  - review status and quality

> **Governance-only:**
> - This workflow does **not** run tests or launch browsers/devices.
> - It does **not** modify UI code, styles, themes, or configs.
> - It does **not** change design tokens or design system definitions.
> - It does **not** create patches/PRs or apply refactors.
> - It only reads artifacts and produces an audit report.
>
> **Scope vs `/smartspec_ui_validation`:**
> - `/smartspec_ui_consistency_audit` focuses on **design & pattern
>   consistency** (visual, structural, token usage, theming, naming).
> - `/smartspec_ui_validation` focuses on **correctness & test
>   coverage** (behavior, a11y, i18n, flows, error states).
> - They are complementary and may be used together for full UI
>   governance.
>
> **Executable code rule:**
> - The workflow may describe design/system issues and conceptual
>   improvements but MUST NOT emit ready-to-apply CSS/JS code, patch/PR
>   text, or refactor diffs as “approved” changes.
>
> **AI-generated UI JSON rule:**
> - AI MAY generate `ui.json`, but this workflow treats unreviewed
>   AI-generated specs with extra caution, especially for critical/high
>   flows.
> - `ui.json` MUST NOT contain business logic. If logic-like constructs
>   (e.g., `if user.role == "admin"`) are detected inside `ui.json`,
>   they MUST be flagged as a high-risk consistency and governance
>   issue.

Use this workflow when you want a **structured view of how consistently
(and safely) your UI adheres to the design system and brand standards,
including how much you can trust AI-generated `ui.json`.**

The `blocking_for_release` recommendations from this workflow are
intended as **design-governance signals** to be considered alongside
other workflows such as `/smartspec_ui_validation` and
`/smartspec_release_readiness`. They do not override other workflows but
blocking items should be explicitly addressed or risk-accepted by
design/UX and release decision-makers.

---

## 2) When to Use

Use `/smartspec_ui_consistency_audit` when:

- you have:
  - a design system (tokens, components, patterns, themes), and
  - UI implementations using that system (web/mobile/desktop), and
- `ui.json` (or equivalent) is used as a **source of truth**, often
  generated by AI, and
- you want to:
  - find inconsistent usage of tokens/components/patterns
  - detect divergence from brand guidelines and design system
  - detect risky or low-quality AI-generated `ui.json`
  - identify screens/flows drifting away from the intended system

Typical chain:

`design_system → design_UI (spec + ui.json) → generate_ui.json (AI) → implement_UI → /smartspec_ui_consistency_audit → /smartspec_ui_validation → /smartspec_release_readiness`

Do **not** use this workflow to:

- propose a brand-new design system (beyond gap identification)
- refactor UI code automatically
- decide behavior/test coverage (use `/smartspec_ui_validation`)

---

## 3) Inputs / Outputs

### 3.1 Inputs (artifacts, read-only)

- **Index**
  - `.spec/SPEC_INDEX.json` (canonical)
  - `SPEC_INDEX.json` at repo root (legacy)
  - `.smartspec/SPEC_INDEX.json` (deprecated)
  - `specs/SPEC_INDEX.json` (older layout)

- **Specs & tasks**
  - `specs/<category>/<spec-id>/spec.md`
  - `specs/<category>/<spec-id>/tasks.md`
  - UI-specific docs referenced by SPEC_INDEX
    (e.g., `ui.md`, `ux_flows.md`, `ui_principles.md`)

- **UI specs (JSON-first & alternatives)**
  - canonical UI JSON locations defined by your base SmartSpec
    governance (e.g., `.spec/ui/` or
    `specs/<category>/<spec-id>/ui.json`).
  - additional paths from `--ui-spec-paths`:
    - `ui.json`, `*.ui.json`, or similar structural definitions.
  - UI JSON is treated as primary when present, especially in
    JSON-first UI projects.

  The workflow expects (but does not enforce) a `meta` block in
  `ui.json`, for example:

  ```jsonc
  {
    "meta": {
      "source": "ai",              // ai | human | mixed | unknown
      "generator": "kilo-code-vX", // or workflow/agent id
      "generated_at": "2025-12-09T12:34:56Z",
      "design_system_version": "ds-v3.1",
      "style_preset": "modern-dashboard-v2",
      "review_status": "unreviewed" // unreviewed | designer_approved | overridden
    },
    "screens": [ /* ... */ ]
  }
  ```

  When such metadata is present, the workflow MUST read and use it as a
  signal for origin, trust, and alignment.

- **Design system & tokens (read-only)**
  - `--design-tokens-paths`
    - design tokens (colors, typography, spacing, radius, shadows, etc.)
  - `--design-system-doc-paths`
    - component/pattern documentation.
  - `--theme-config-paths`
    - theme/dark-mode/brand theme config.

- **UI implementation structure (read-only)**
  - `--ui-impl-paths`
    - code directories where UI components/routes live.
  - used heuristically to:
    - map which components/screens are used where.
    - identify potential divergences from design system usage.

All artifacts are treated as **read-only**.

### 3.2 Inputs (flags)

See **5) Flags**.

### 3.3 Outputs

- **UI consistency audit report**
  - default location:
    `.spec/reports/smartspec_ui_consistency_audit/<timestamp>_<run-label>.md`
  - if `--report-format=json`:
    `.spec/reports/smartspec_ui_consistency_audit/<timestamp>_<run-label>.json`

#### 3.3.1 Per-UI-unit status model

A **UI unit** typically represents a screen, route, or component group.

For each unit, the report SHOULD include:

- `unit_id`
  - route, screen ID, or logical name.

- `criticality`
  - `CRITICAL`, `HIGH`, `MEDIUM`, `LOW`, `UNKNOWN`
  - derived from registries/specs (e.g., primary flows vs secondary).

- `ui_spec_origin`
  - `AI`, `HUMAN`, `MIXED`, `UNKNOWN`
  - derived from `ui.json` meta (e.g., `meta.source`) when present,
    otherwise inferred or left `UNKNOWN`.

- `ui_spec_review_status`
  - `UNREVIEWED`, `DESIGNER_APPROVED`, `OVERRIDDEN`, `UNKNOWN`
  - derived from `ui.json` meta (e.g., `meta.review_status`) or
    registries, if available.

- `ui_json_quality_status`
  - `STRONG` – UI JSON appears coherent and aligned with design system
    (structure, states, patterns, meta complete).
  - `OK` – generally acceptable, some minor issues.
  - `WEAK` – incomplete structure, missing key states, or poor
    alignment.
  - `BROKEN` – clearly inconsistent or invalid.
  - `UNKNOWN` – insufficient info.

- `design_system_alignment_status`
  - `GOOD` – strong alignment with design system.
  - `MINOR_DRIFT` – small deviations, mostly consistent.
  - `MAJOR_DRIFT` – significant divergence from system.
  - `UNKNOWN` – insufficient info.

- `token_usage_status`
  - `CONSISTENT` – uses design tokens for core styles.
  - `MIXED` – mix of tokens and hard-coded values.
  - `HARD_CODED` – primarily hard-coded styles.
  - `UNKNOWN`.

- `spacing_consistency_status`
  - `CONSISTENT` – spacing scale follows system.
  - `MINOR_ISSUES` – occasional off-scale spacing.
  - `MAJOR_ISSUES` – frequent inconsistent spacing.
  - `UNKNOWN`.

- `typography_consistency_status`
  - `CONSISTENT` – typography tokens/scale followed.
  - `MINOR_ISSUES` – minor deviations.
  - `MAJOR_ISSUES`.
  - `UNKNOWN`.

- `component_pattern_consistency_status`
  - `CONSISTENT` – shared components/patterns reused properly.
  - `PARTIAL` – some duplication or ad-hoc patterns.
  - `FRAGMENTED` – many custom components where design system exists.
  - `UNKNOWN`.

- `state_handling_consistency_status`
  - `GOOD` – hover/focus/disabled/loading/states consistent.
  - `MINOR_ISSUES`.
  - `MAJOR_ISSUES`.
  - `UNKNOWN`.

- `dark_mode_consistency_status`
  - `NOT_APPLICABLE` – dark mode not required.
  - `CONSISTENT` – light/dark themes aligned.
  - `PARTIAL` – some screens/flows not fully themed.
  - `BROKEN` – major inconsistencies (e.g., unreadable text).
  - `UNKNOWN`.

- `naming_consistency_status`
  - `GOOD` – component/token names follow conventions.
  - `MINOR_ISSUES`.
  - `MAJOR_ISSUES`.
  - `UNKNOWN`.

- `risk_level`
  - `LOW`, `MEDIUM`, `HIGH`, `CRITICAL`.

- `blocking_for_release`
  - `true` | `false` – design-governance recommendation.

- `notes`
  - explanation and rationale.

#### 3.3.2 Aggregated summary

The report SHOULD also include:

- counts of units by `risk_level`
- counts of units by `blocking_for_release`
- counts of units with:
  - `design_system_alignment_status=MAJOR_DRIFT`
  - `token_usage_status=HARD_CODED`
  - `dark_mode_consistency_status=BROKEN` where dark mode is required
  - `component_pattern_consistency_status=FRAGMENTED` for critical/high
    flows
  - `ui_spec_origin=AI` and `ui_spec_review_status=UNREVIEWED` for
    critical/high flows
  - `ui_json_quality_status=WEAK/BROKEN`

> **Canonical structure note:**
> - When `--report-format=json`, the JSON structure (per-unit fields
>   above + summary section) is the canonical representation.
> - The markdown variant MUST present the same per-unit fields (e.g., as
>   tables or clearly labeled sections) so that tooling can map between
>   `.md` and `.json` deterministically.

Optionally, a **stdout summary** when `--stdout-summary` is enabled.

---

## 4) Modes

### 4.1 Role & write guard

- Role: **Verification / Governance**
- Write guard: **NO-WRITE**

MUST NOT:

- modify UI code, styles, themes, or configs.
- change design tokens or design system docs.
- create patches/PRs or refactor code.

MAY:

- read artifacts.
- generate consistency audit reports.
- print summaries.

### 4.2 Platform semantics

- Framework-agnostic (React, Vue, Native, etc.).
- Works via:
  - design tokens / design system registry.
  - UI specs / UI JSON.
  - implementation structure hints.

- Under Kilo (with `--kilocode` and Kilo detected):

  - effective mode: **Ask / Architect**, **NO-WRITE**.
  - must follow **Kilo Orchestrator-per-task rule**:
    - before each top-level task (spec-id or UI group), switch to
      Orchestrator and decompose subtasks, unless `--nosubtasks` is
      set.
  - default under Kilo: **subtasks ON**.

  - typical loop:
    1) Orchestrator selects one app/spec-id.
    2) Subtasks (examples):
       - gather design tokens & system docs.
       - gather UI specs / UI JSON (including metadata).
       - scan implementation structure hints.
       - compute per-unit consistency and AI-origin statuses.
    3) Code mode inspects artifacts (read-only).
    4) Orchestrator synthesizes per-unit and summary findings.

- If `--kilocode` is present but Kilo is not detected:
  - treat `--kilocode` as a **no-op meta-flag**.
  - run a single-flow reasoning path.

Write guard remains **NO-WRITE**.

---

## 5) Flags

> All flags are additive; no legacy flags are changed.

### 5.1 Scope & labeling

- `--spec-ids=<id1,id2,...>`
  - spec-ids whose UI consistency should be audited.

- `--ui-targets=<id1,id2,...>`
  - optional list of specific UI units (routes/screens/flows) to focus
    on.

- `--include-dependencies`
  - include shared components/layouts identified via SPEC_INDEX and
    registries.

- `--run-label=<string>`
  - label for this audit run.

### 5.2 UI specs & implementation

- `--ui-spec-paths="<glob1>;<glob2>;..."`
  - additional paths for UI specs / UI JSON beyond canonical locations.

- `--ui-impl-paths="<glob1>;<glob2>;..."`
  - UI implementation source directories (read-only).

- `--ui-json-mode=<auto|required|disabled>`
  - `auto` (default): detect canonical UI JSON and supplement with
    `--ui-spec-paths`.
  - `required`: treat missing UI JSON as a consistency gap.
  - `disabled`: assume no UI JSON; rely on markdown and docs.

- `--ui-json-ai-strict`
  - optional flag to enforce stricter rules for AI-generated UI JSON:
    - treat `ui_spec_origin=AI` & `ui_spec_review_status=UNREVIEWED`
      for critical/high units as at least `HIGH` risk.
    - require `design_system_version` and `style_preset` metadata to be
      present; absence is treated as a consistency gap.

### 5.3 Design system & tokens

- `--design-tokens-paths="<glob1>;<glob2>;..."`
  - design tokens (JSON/YAML/etc.).

- `--design-system-doc-paths="<glob1>;<glob2>;..."`
  - component and pattern documentation.

- `--theme-config-paths="<glob1>;<glob2>;..."`
  - theming configs (light/dark, brand themes).

### 5.4 Environment & brand context

- `--target-envs=<env1,env2,...>`
  - e.g., `web,ios,android`.

- `--target-brands=<brand1,brand2,...>`
  - if multiple brands/themes exist.

Used to interpret whether dark mode/themes or brand variants are
required and which variants to expect.

### 5.5 Multi-repo / registry / index / safety

- `--workspace-roots="<path1>;<path2>;..."`
- `--repos-config=<path>`
- `--registry-dir=<path>`
- `--registry-roots="<path1>;<path2>;..."`
- `--index=<path>` / `--specindex=<path>`
- `--safety-mode=<normal|strict>`
  - `--strict` is a legacy alias.

Semantics:

- `--repos-config` preferred for mapping spec-ids ↔ apps.
- `--workspace-roots` is a discovery hint only.
- `--registry-dir` is primary registry root (default `.spec/registry`).
- `--registry-roots` are read-only supplemental registries.

### 5.6 Safety-mode (normal vs strict)

**Normal (default)**

- Reports drift/gaps with recommendations.
- `blocking_for_release` mostly for:
  - brand-critical or regulated flows where:
    - `design_system_alignment_status=MAJOR_DRIFT`, or
    - `token_usage_status=HARD_CODED` in critical areas, or
    - `dark_mode_consistency_status=BROKEN` where dark mode is required.
  - AI-generated UI JSON concerns where:
    - `ui_spec_origin=AI` and `ui_spec_review_status=UNREVIEWED` for
      critical/high units, or
    - `ui_json_quality_status=WEAK/BROKEN` on critical/high units.

**Strict (`--safety-mode=strict` / `--strict`)**

For units with `criticality in {CRITICAL, HIGH}`:

- Treat as **blocking**, unless explicitly justified in specs/registry,
  when ANY of the following hold:

  - `design_system_alignment_status=MAJOR_DRIFT`.
  - `token_usage_status=HARD_CODED` for core surfaces.
  - `component_pattern_consistency_status=FRAGMENTED` on major flows
    where a standard pattern exists.
  - `dark_mode_consistency_status=BROKEN` where dark mode is required
    by policy or brand guidelines.
  - `ui_spec_origin=AI` AND `ui_spec_review_status=UNREVIEWED`.
  - `ui_json_quality_status=WEAK` or `BROKEN`.
  - missing or inconsistent `design_system_version` or `style_preset`
    metadata where such metadata is required.
  - business-logic-like constructs detected inside `ui.json`.

For units with `criticality=MEDIUM`:

- may be blocking when combinations of statuses yield
  `risk_level=CRITICAL` (e.g., FRAGMENTED patterns + HARD_CODED tokens
  in important areas).

For units with `criticality=LOW`:

- blocking is typically reserved for severe brand/regulatory issues or
  obvious governance violations (e.g., logic inside `ui.json`).

All `blocking_for_release=true` decisions MUST be explained in `notes`.

### 5.7 Output control

- `--report-format=<md|json>`
  - default: `md`.

- `--report-dir=<path>`
  - default: `.spec/reports/smartspec_ui_consistency_audit/`.

- `--stdout-summary`
  - print a short summary.

### 5.8 Kilo / subtasks

- `--kilocode`
- `--nosubtasks`
  - disables Orchestrator auto-subtasking but preserves per-task logic.

---

## 6) Canonical Folders & File Placement

The workflow MUST follow SmartSpec canonical layout:

1. **Index detection order**:
   1) `.spec/SPEC_INDEX.json` (canonical)
   2) `SPEC_INDEX.json` at repo root (legacy)
   3) `.smartspec/SPEC_INDEX.json` (deprecated)
   4) `specs/SPEC_INDEX.json` (older layout)

2. **Specs & tasks**:
   - `specs/<category>/<spec-id>/spec.md`
   - `specs/<category>/<spec-id>/tasks.md`

3. **UI specs**:
   - canonical UI JSON locations defined by base governance (e.g.,
     `.spec/ui/` or `specs/<category>/<spec-id>/ui.json`) MUST be used
     as primary.
   - `--ui-spec-paths` MUST be used only to supplement or discover
     additional UI specs, not to override canonical conventions.

4. **Registries**:
   - primary `.spec/registry/`.
   - additional `--registry-roots` as read-only.

5. **Reports**:
   - `.spec/reports/smartspec_ui_consistency_audit/<timestamp>_<run-label>.{md|json}`.

The workflow MUST NOT create new top-level folders outside `.spec/`
by default.

---

## 7) Weakness & Risk Check (Quality Gate)

Before treating this workflow spec as complete, verify that it:

1. Keeps **NO-WRITE** and governance-only.
   - no code/styles/themes/config changes.
   - no patches/PRs.

2. Clearly separates scope from `/smartspec_ui_validation`.
   - focuses on design/tokens/patterns/themes/naming.
   - defers behavior/test coverage/a11y/i18n to validation workflows.

3. Respects JSON-first UI governance.
   - handles `--ui-json-mode` correctly.
   - does not conflict with canonical UI JSON locations.
   - does not propose moving UI JSON to non-canonical locations.

4. Uses the defined status model consistently.
   - populates per-unit statuses using defined enums.
   - does not invent arbitrary labels.
   - keeps JSON as canonical; markdown mirrors the same fields.

5. Leverages design tokens and registries as source of truth.
   - uses tokens/registry docs rather than inventing new visual rules.

6. Accounts for multi-env/brand context where available.
   - uses `--target-envs` and `--target-brands` to interpret theme
     requirements.

7. Handles AI-generated UI JSON explicitly.
   - uses `ui_spec_origin`, `ui_spec_review_status`, and
     `ui_json_quality_status` as first-class signals.
   - treats unreviewed AI-generated specs for critical/high flows as
     elevated risk.
   - flags business logic inside `ui.json` as a severe issue.

8. Protects against suggesting direct code patches.
   - may include conceptual refactoring guidance, but no ready-to-apply
     diffs or commands.

9. Explains `blocking_for_release` decisions.
   - especially under strict mode for critical/high flows.

---

## 8) Legacy Flags Inventory

New workflow:

- **Kept as-is**:
  - (none – new workflow).

- **Legacy alias**:
  - `--strict` → alias for `--safety-mode=strict`.

- **New additive flags**:
  - `--spec-ids`
  - `--ui-targets`
  - `--include-dependencies`
  - `--run-label`
  - `--ui-spec-paths`
  - `--ui-impl-paths`
  - `--ui-json-mode`
  - `--ui-json-ai-strict`
  - `--design-tokens-paths`
  - `--design-system-doc-paths`
  - `--theme-config-paths`
  - `--target-envs`
  - `--target-brands`
  - `--workspace-roots`
  - `--repos-config`
  - `--registry-dir`
  - `--registry-roots`
  - `--index`
  - `--specindex`
  - `--safety-mode`
  - `--report-format`
  - `--report-dir`
  - `--stdout-summary`
  - `--kilocode`
  - `--nosubtasks`

---

## 9) KiloCode Support (Meta-Flag)

As a verification/governance workflow:

- accepts `--kilocode`.
- role under Kilo: **Ask / Architect**, **NO-WRITE**.
- default: subtasks ON, unless `--nosubtasks` is set.
- must follow Kilo Orchestrator-per-task rule.

### 9.1 Orchestrator loop (Kilo + subtasks)

For each spec-id or UI group:

1. Orchestrator gathers:
   - design tokens and system docs.
   - UI specs and UI JSON (with metadata).
   - implementation hints.
   - relevant registries (design system versions, critical flows,
     branding).
2. Code mode (read-only) parses and builds per-unit status records.
3. Orchestrator aggregates per-unit results and summary by scope.

### 9.2 Non-Kilo environments

- treat `--kilocode` as no-op.
- perform equivalent logic in a single reasoning flow.

---

## 10) Inline Detection Rules

The workflow must not call other SmartSpec workflows for detection.
Instead, it:

1. inspects environment/system prompts for Kilo/ClaudeCode/Antigravity
   markers.
2. checks for `--kilocode`.
3. if ambiguous, defaults to tool-agnostic behavior and may record this
   in the report header.

---

## 11) Multi-repo / Multi-registry Rules

1. Use `--repos-config` for mapping spec-ids to apps/repos.
2. Use `--workspace-roots` only as a discovery hint, never to invent
   spec-ids outside SPEC_INDEX.
3. Use registries for:
   - design tokens and design system versions.
   - critical flows and brand-critical surfaces.
4. Respect external ownership:
   - if a design system is owned by another team, prefer reuse and
     alignment over proposing forks.

---

## 12) UI Addendum (AI-generated UI JSON)

This workflow is UI-centric and must respect UI governance:

1. **JSON-first UI**
   - treat UI JSON as the primary UI spec.
   - when `--ui-json-mode=required`:
     - missing or incomplete UI JSON for a screen/flow is a consistency
       gap and influences `ui_json_quality_status`,
       `design_system_alignment_status`, and `risk_level`.
   - ensure `ui.json` stays **declarative** (no business logic).

2. **AI-generated UI JSON metadata**
   - when `meta.source=ai` and/or `meta.generator` indicates AI:
     - record `ui_spec_origin=AI`.
     - if `meta.review_status=unreviewed` → `ui_spec_review_status=UNREVIEWED`.
   - expect `meta.design_system_version` and `meta.style_preset` to
     match design system registries where applicable.
   - missing or inconsistent metadata for critical/high flows should
     raise `risk_level` and may trigger `blocking_for_release` in
     strict mode.

3. **Inline UI / opt-out**
   - when `ui-json-mode=disabled`:
     - do not assume UI JSON exists.
     - rely on markdown specs, tasks, and other docs.
     - still apply the same status model per UI unit (some statuses may
       be `UNKNOWN` more often).

4. **Modern design expectations**
   - consistency checks SHOULD consider:
     - responsive layouts where relevant.
     - use of modern patterns (e.g., cards, sections, spacing scales)
       as defined by your design system.
   - the workflow does NOT replace designers; it only enforces
     consistency with the agreed design language.

---

## 13) Best Practices (for Users)

- Keep design tokens and design system docs up to date and versioned.
- Encourage AI-generated `ui.json` to always fill `meta` fields:
  - `source`, `generator`, `generated_at`,
    `design_system_version`, `style_preset`, `review_status`.
- Avoid embedding business logic or real data in UI JSON.
- Run this audit:
  - before major releases,
  - after significant design system changes,
  - after large-scale AI-regenerated UI specs.
- Use `--safety-mode=strict` and `--ui-json-ai-strict` for:
  - brand-critical or regulated flows.
  - flows where AI has recently regenerated UI JSON.
- Pair this workflow with:
  - `/smartspec_ui_validation` for behavior/test coverage.
  - `/smartspec_release_readiness` for overall release gates.
- Keep audit reports under version control as part of release
  artifacts.

---

## 14) For the LLM / Flow & Stop Conditions

### 14.1 Step-by-step flow

1. **Resolve scope**
   - parse `--spec-ids`, `--ui-targets`, `--include-dependencies`,
     `--run-label`, `--ui-json-mode`, `--ui-json-ai-strict`,
     `--target-envs`, `--target-brands`.
   - load SPEC_INDEX in canonical order.

2. **Gather artifacts**
   - load specs/tasks for scoped spec-ids.
   - load UI specs and UI JSON from canonical locations and
     `--ui-spec-paths`.
   - load design tokens, design system docs, and theme configs.
   - load implementation hints from `--ui-impl-paths`.
   - load relevant registries (design system versions, critical flows,
     branding).

3. **Identify UI units & criticality**
   - derive screens/routes/flows from UI specs/JSON + SPEC_INDEX.
   - if `--ui-targets` provided, limit to those units.
   - determine `criticality` per unit using registries/specs.
   - for each unit, derive `ui_spec_origin`, `ui_spec_review_status`,
     and initial `ui_json_quality_status` from metadata/structure.

4. **Compute per-unit statuses**
   - evaluate `design_system_alignment_status`, `token_usage_status`,
     `spacing_consistency_status`, `typography_consistency_status`,
     `component_pattern_consistency_status`,
     `state_handling_consistency_status`, `dark_mode_consistency_status`,
     `naming_consistency_status`.
   - refine `ui_json_quality_status` based on structure and
     inconsistencies.
   - detect any business-logic-like constructs inside `ui.json` and
     flag them.
   - compute `risk_level` and `blocking_for_release` using safety-mode
     rules.

5. **Aggregate**
   - compute unit counts by `risk_level` and `blocking_for_release`.
   - highlight high-risk / blocking units, especially where
     `ui_spec_origin=AI` and `ui_spec_review_status=UNREVIEWED`.

6. **Generate report**
   - serialize per-unit data and summary to `.md` or `.json` in
     `--report-dir`.
   - ensure markdown representation mirrors the JSON fields.

7. **Optional stdout summary**
   - if `--stdout-summary`, print:
     - number of units.
     - number of blocking units.
     - list of top-risk units.

### 14.2 Stop Conditions

The workflow MUST stop after:

- writing (or simulating writing) the audit report, and
- printing any optional stdout summary.

It MUST NOT:

- modify code, styles, tokens, configs, or docs.
- run UI tests or browsers/devices.
- call other SmartSpec workflows directly (only reference them as
  recommendations).

