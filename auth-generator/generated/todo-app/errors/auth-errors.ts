/**
 * Auth Errors
 * 
 * Custom error classes with sanitized messages for security
 * Generated by SmartSpec Auth Generator
 */

/**
 * Base authentication error
 */
export class AuthError extends Error {
  public readonly code: string;
  public readonly statusCode: number;
  public readonly isOperational: boolean;

  constructor(message: string, code: string, statusCode: number = 401) {
    super(message);
    this.name = 'AuthError';
    this.code = code;
    this.statusCode = statusCode;
    this.isOperational = true;
    Error.captureStackTrace(this, this.constructor);
  }
}

/**
 * Invalid credentials error (login failures)
 * Generic message to prevent user enumeration
 */
export class InvalidCredentialsError extends AuthError {
  constructor() {
    super(
      'Invalid credentials',
      'INVALID_CREDENTIALS',
      401
    );
    this.name = 'InvalidCredentialsError';
  }
}

/**
 * Account locked error
 */
export class AccountLockedError extends AuthError {
  constructor(remainingMinutes?: number) {
    const message = remainingMinutes
      ? `Account is temporarily locked. Try again in ${remainingMinutes} minutes`
      : 'Account is temporarily locked';
    
    super(message, 'ACCOUNT_LOCKED', 423);
    this.name = 'AccountLockedError';
  }
}

/**
 * Invalid or expired token error
 * Generic message to prevent token validation attacks
 */
export class InvalidTokenError extends AuthError {
  constructor() {
    super(
      'Invalid or expired token',
      'INVALID_TOKEN',
      401
    );
    this.name = 'InvalidTokenError';
  }
}

/**
 * Password validation error
 * Generic message without revealing specific requirements
 */
export class WeakPasswordError extends AuthError {
  constructor() {
    super(
      'Password does not meet security requirements',
      'WEAK_PASSWORD',
      400
    );
    this.name = 'WeakPasswordError';
  }
}

/**
 * Email already registered error
 * Generic message to prevent email enumeration
 */
export class EmailInUseError extends AuthError {
  constructor() {
    super(
      'Unable to complete registration',
      'REGISTRATION_FAILED',
      400
    );
    this.name = 'EmailInUseError';
  }
}

/**
 * User not found error
 * Generic message to prevent user enumeration
 */
export class UserNotFoundError extends AuthError {
  constructor() {
    super(
      'Invalid credentials',
      'INVALID_CREDENTIALS',
      401
    );
    this.name = 'UserNotFoundError';
  }
}

/**
 * Email not verified error
 */
export class EmailNotVerifiedError extends AuthError {
  constructor() {
    super(
      'Email verification required',
      'EMAIL_NOT_VERIFIED',
      403
    );
    this.name = 'EmailNotVerifiedError';
  }
}

/**
 * Email already verified error
 */
export class EmailAlreadyVerifiedError extends AuthError {
  constructor() {
    super(
      'Email is already verified',
      'EMAIL_ALREADY_VERIFIED',
      400
    );
    this.name = 'EmailAlreadyVerifiedError';
  }
}

/**
 * Rate limit exceeded error
 */
export class RateLimitError extends AuthError {
  constructor(retryAfter?: number) {
    const message = retryAfter
      ? `Too many requests. Try again in ${retryAfter} seconds`
      : 'Too many requests. Please try again later';
    
    super(message, 'RATE_LIMIT_EXCEEDED', 429);
    this.name = 'RateLimitError';
  }
}

/**
 * Unauthorized error
 */
export class UnauthorizedError extends AuthError {
  constructor() {
    super(
      'Unauthorized',
      'UNAUTHORIZED',
      401
    );
    this.name = 'UnauthorizedError';
  }
}

/**
 * Forbidden error (insufficient permissions)
 */
export class ForbiddenError extends AuthError {
  constructor() {
    super(
      'Insufficient permissions',
      'FORBIDDEN',
      403
    );
    this.name = 'ForbiddenError';
  }
}

/**
 * Error response formatter
 */
export interface ErrorResponse {
  success: false;
  error: {
    message: string;
    code: string;
  };
}

/**
 * Format error for API response
 * Only includes safe information for clients
 */
export function formatErrorResponse(error: Error): ErrorResponse {
  if (error instanceof AuthError) {
    return {
      success: false,
      error: {
        message: error.message,
        code: error.code,
      },
    };
  }

  // For unknown errors, return generic message
  return {
    success: false,
    error: {
      message: 'An error occurred',
      code: 'INTERNAL_ERROR',
    },
  };
}

/**
 * Check if error is operational (expected) or programming error
 */
export function isOperationalError(error: Error): boolean {
  if (error instanceof AuthError) {
    return error.isOperational;
  }
  return false;
}
