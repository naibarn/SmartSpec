/**
 * Type Guards
 * 
 * Runtime type checking utilities
 * Generated by SmartSpec Auth Generator
 */

import { JWTPayload, User, UserRole } from '../types/auth.types';

/**
 * Check if value is a valid JWT payload
 */
export function isJWTPayload(value: unknown): value is JWTPayload {
  if (typeof value !== 'object' || value === null) {
    return false;
  }

  const payload = value as Record<string, unknown>;

  return (
    typeof payload.userId === 'string' &&
    typeof payload.email === 'string' &&
    typeof payload.role === 'string' &&
    typeof payload.type === 'string' &&
    (payload.type === 'access' || payload.type === 'refresh')
  );
}

/**
 * Check if value is a valid User object
 */
export function isUser(value: unknown): value is User {
  if (typeof value !== 'object' || value === null) {
    return false;
  }

  const user = value as Record<string, unknown>;

  return (
    typeof user.id === 'string' &&
    typeof user.email === 'string' &&
    typeof user.password === 'string' &&
    typeof user.role === 'string' &&
    user.createdAt instanceof Date &&
    user.updatedAt instanceof Date
  );
}

/**
 * Check if value is a valid UserRole
 */
export function isUserRole(value: unknown): value is UserRole {
  if (typeof value !== 'string') {
    return false;
  }

  const validRoles: string[] = [
    '[object Object]',
    '[object Object]',
  ];

  return validRoles.includes(value);
}

/**
 * Assert that user has required role
 */
export function assertUserRole(user: JWTPayload | User, requiredRole: UserRole): void {
  if (user.role !== requiredRole) {
    throw new Error(`User role '${user.role}' does not match required role '${requiredRole}'`);
  }
}

/**
 * Assert that user has one of the required roles
 */
export function assertUserRoles(user: JWTPayload | User, requiredRoles: UserRole[]): void {
  if (!requiredRoles.includes(user.role as UserRole)) {
    throw new Error(`User role '${user.role}' is not in required roles: ${requiredRoles.join(', ')}`);
  }
}

/**
 * Check if value is a valid email
 */
export function isValidEmail(value: unknown): value is string {
  if (typeof value !== 'string') {
    return false;
  }

  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return emailRegex.test(value);
}

/**
 * Check if value is a non-empty string
 */
export function isNonEmptyString(value: unknown): value is string {
  return typeof value === 'string' && value.trim().length > 0;
}

/**
 * Assert that value is defined (not null or undefined)
 */
export function assertDefined<T>(value: T | null | undefined, message?: string): asserts value is T {
  if (value === null || value === undefined) {
    throw new Error(message || 'Value is null or undefined');
  }
}

/**
 * Safe type assertion with runtime check
 */
export function safeAssert<T>(
  value: unknown,
  guard: (value: unknown) => value is T,
  message?: string
): T {
  if (!guard(value)) {
    throw new Error(message || 'Type assertion failed');
  }
  return value;
}
